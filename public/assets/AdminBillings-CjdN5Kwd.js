import{d as es,p as N,k as os,r as g,l as z,O as as,o as l,c as r,b as s,t as i,e as v,f as p,w as k,T as F,q as L,s as m,y as ns,v as G,g as O,x as J,G as q,H as is,A as Q,C as ds,D as ls,_ as cs}from"./index-bJf0D_xI.js";import{a as w}from"./index-DNXFy-b_.js";import{u as rs}from"./adminParamsStore-BaX_Kbe9.js";import{u as b}from"./useFunctions-7hk1pswv.js";import{d as _s}from"./index-CeG8Vrn-.js";import{j as ps}from"./maska-Cp-LWreF.js";import{J as us}from"./StartCompany_jsonData-D7IJQ8VJ.js";const n=C=>(ds("data-v-036fc652"),C=C(),ls(),C),ms={class:"container"},vs=n(()=>s("h5",{class:"fw-bold page-title mb-4"}," Billing",-1)),bs={class:"row g-4"},hs={class:"col-lg-12"},gs={class:"card shadow-sm py-3"},fs={class:"card-body"},ys={class:"row g-3"},xs={class:"col-lg-3 col-md-6"},ks={class:"card h-100 border-grey"},ws={class:"card-body"},Cs={class:"small text-grey fw-bold"},Is={class:"fs-4 text-primary fw-bold"},Ts=n(()=>s("div",{class:"small text-grey fw-bold"},"Total in Last 31 Days",-1)),Ns=n(()=>s("div",{class:"fw-bold"},"$0",-1)),Ls={class:"card-footer border-0 bg-transparent"},Ss={key:0,class:"spinner-border text-primary spinner-border-sm float-end",role:"status"},Ps=n(()=>s("span",{class:"visually-hidden"},"Loading...",-1)),As=[Ps],Ds=n(()=>s("i",{class:"bi bi-arrow-clockwise"},null,-1)),Es={class:"col-lg-3 col-md-6"},Us={class:"card h-100 border-grey"},Os={class:"card-body"},Ms={class:"small text-grey fw-bold"},Bs={class:"fs-4 text-primary fw-bold"},$s={class:"small text-grey fw-bold"},Vs={class:"fw-bold"},Ys={class:"card-footer border-0 bg-transparent"},Hs={key:0,class:"spinner-border text-primary spinner-border-sm float-end",role:"status"},Rs=n(()=>s("span",{class:"visually-hidden"},"Loading...",-1)),js=[Rs],zs=n(()=>s("i",{class:"bi bi-arrow-clockwise"},null,-1)),Fs={class:"col-lg-3 col-md-6"},Gs={class:"card h-100",style:{border:"1px blue solid !important"}},Js={class:"card-body"},qs=n(()=>s("div",{class:"fw-bold"},"Plans Subscription",-1)),Qs={class:"list-group list-group-flush xsmall"},Xs={class:"list-group-item p-0 border-0"},Ks=n(()=>s("strong",{class:"text-muted"},"Name:",-1)),Ws={class:"float-end"},Zs={class:"list-group-item p-0 border-0"},st=n(()=>s("strong",{class:"text-muted"},"Amount:",-1)),tt={class:"float-end"},et={class:"list-group-item p-0 border-0"},ot=n(()=>s("strong",{class:"text-muted"},"Duration:",-1)),at={class:"float-end"},nt={class:"list-group-item p-0 border-0"},it=n(()=>s("strong",{class:"text-muted"},"Currency:",-1)),dt={class:"float-end"},lt={class:"card-footer border-0 bg-transparent"},ct=n(()=>s("i",{class:"bi bi-plus-lg"},null,-1)),rt=n(()=>s("i",{class:"bi bi-pencil"},null,-1)),_t={class:"col-lg-3 col-md-6"},pt={class:"card h-100",style:{border:"1px blue solid !important"}},ut={class:"card-body"},mt=n(()=>s("div",{class:"fw-bold"},"Subscriptions",-1)),vt={class:"list-group list-group-flush xsmall"},bt={class:"list-group-item p-0 border-0"},ht=n(()=>s("strong",{class:"text-muted"},"Active Subcriptions:",-1)),gt={class:"float-end badge bg-success-subtle text-dark"},ft={class:"list-group-item p-0 border-0"},yt=n(()=>s("strong",{class:"text-muted"},"Cancelled subscriptions:",-1)),xt={class:"float-end badge bg-danger-subtle text-dark"},kt={class:"card-footer border-0 bg-transparent"},wt={key:0,class:"spinner-border text-primary spinner-border-sm float-end",role:"status"},Ct=n(()=>s("span",{class:"visually-hidden"},"Loading...",-1)),It=[Ct],Tt=n(()=>s("i",{class:"bi bi-arrow-clockwise"},null,-1)),Nt={class:"col-12 mt-4"},Lt={class:"card shadow-sm min-vh-100"},St={class:"card-body"},Pt=n(()=>s("div",{class:"card-header fw-bold bg-transparent border-0 px-0 py-3"}," Billing Table ",-1)),At={class:"fw-bold text-muted"},Dt={key:0,class:"badge bg-success-subtle text-dark"},Et={key:1,class:"badge bg-secondary-subtle text-dark"},Ut={key:0,class:"text-nowrap"},Ot=["href"],Mt=n(()=>s("i",{class:"bi bi-file-arrow-down-fill"},null,-1)),Bt=[Mt],$t={key:1},Vt={class:"col-12 mt-4"},Yt={class:"card shadow-sm min-vh-100"},Ht={class:"card-body"},Rt=n(()=>s("div",{class:"card-header fw-bold bg-transparent border-0 px-0 py-3"}," Payment History ",-1)),jt={class:"fw-bold text-muted"},zt={class:"dropdown"},Ft={class:"cursor-pointer bell dropdown-toggle","data-bs-toggle":"dropdown","aria-expanded":"false"},Gt=n(()=>s("i",{class:"bi bi-three-dots text-primary"},null,-1)),Jt={class:"dropdown-menu dropdown-menu-start"},qt={class:"list-group list-group-flush"},Qt=n(()=>s("i",{class:"bi bi-trash3"},null,-1)),Xt={class:"modal fade",id:"planModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false",role:"dialog","aria-labelledby":"modalTitleId","aria-hidden":"true"},Kt={class:"modal-dialog modal-dialog-scrollable modal-dialog-centered",role:"document"},Wt={class:"modal-content"},Zt={class:"modal-header text-capitalize border-0"},se={class:"modal-title",id:"modalTitleId"},te={class:"modal-body"},ee={class:"row g-3"},oe=n(()=>s("div",{class:"form-label"},"Name",-1)),ae={key:0,class:"col-lg-6"},ne=n(()=>s("div",{class:"form-label"},"Amount",-1)),ie={key:1,class:"col-lg-6"},de=n(()=>s("div",{class:"form-label"},"Duration",-1)),le=n(()=>s("option",{value:"year",selected:""},"Year",-1)),ce=[le],re={key:2,class:"col-lg-6"},_e=n(()=>s("div",{class:"form-label"},"Currency",-1)),pe=["value"],ue={class:"modal-footer border-0"},me={key:0,class:"btn btn-primary",type:"button",disabled:""},ve=n(()=>s("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),be=es({__name:"AdminBillings",setup(C){const X=rs(),f=_s.useToast(),S=N({list:[]});os(()=>{M(),D(),U()});const K=a=>{a.id;let e="",_="";return S.list.forEach(I=>{const c=I.company.names.find(T=>T.choice_level==1);e=c!=null&&c.eng_name?(c==null?void 0:c.eng_name)+" "+(c==null?void 0:c.eng_prefix):"",_=c!=null&&c.chn_name?(c==null?void 0:c.chn_name)+" "+(c==null?void 0:c.chn_prefix):""}),`${e} ${_}`},W=a=>{a.id;let e="";return S.list.forEach(u=>{e=u.user.name}),e};async function M(){try{const e=(await w.getAllBillings(X.currentCompanyId)).data.data;B.value=e.total,$.value=e.data,S.list=e.data,V.value=!1}catch(a){console.log(a)}}const P=g({page:1,rowsPerPage:15}),A=g({page:1,rowsPerPage:15}),B=g(0),$=g([]),V=g(!0),Z=[{text:"COMPANY NAME",value:"email"},{text:"INVOICE NO",value:"invoice_no"},{text:"DATE ISSUED",value:"date_issued"},{text:"DATE PAID",value:"date_paid"},{text:"AMOUNT",value:"amount_paid"},{text:"PAYMENT METHOD",value:"payment_method"},{text:"STATUS",value:"status"}];z(P,a=>{M()},{deep:!0}),z(A,a=>{D()},{deep:!0});const d=N({isLoading:!0,total_invoices:0,total_invoice_amount:0,unpaid_invoice:0,unpaid_invoice_amount:0,paid_invoice:0,paid_invoice_amount:0,overdue_invoices:0,overdue_invoices_amount:0,active_subscriptions:0,cancelled_subscriptions:0,invoice_paid_this_monthly:0,invoice_unpaid_monthly_amount:0,invoice_paid_monthly_amount:0,invoice_unpaid_monthly:0,billingsTable:[],totalInvoices:0});async function D(){var a;try{const{data:e}=await w.getInvoices(),_=e.data.subscription_summary,u=(a=e==null?void 0:e.data)==null?void 0:a.invoices;d.billingsTable=(u==null?void 0:u.data)??[],d.totalInvoices=(u==null?void 0:u.total)??0,d.total_invoices=_.total_invoices,d.total_invoice_amount=_.total_invoice_amount,d.unpaid_invoice=_.unpaid_invoice,d.unpaid_invoice_amount=_.unpaid_invoice_amount,d.paid_invoice=_.paid_invoice,d.paid_invoice_amount=_.paid_invoice_amount,d.overdue_invoices=_.overdue_invoices,d.overdue_invoices_amount=_.overdue_invoices_amount,d.active_subscriptions=_.active_subscriptions,d.cancelled_subscriptions=_.cancelled_subscriptions,d.isLoading=!1}catch(e){console.log(e)}}const y=N({paid:!1,unpaid:!1,subscribers:!1});async function E(a){y[a]=!0;try{await D(),f.success("Invoice Updated",{position:"top-right"}),y[a]=!1}catch{f.error("Error, Something went wrong",{position:"top-right"}),y[a]=!1}}const o=N({data:null,action:"create",isLoading:!1,formName:"",formPrice:"",formInterval:"year",formCurrency:"USD"}),Y=g(null),x=g(null);async function U(){try{o.isLoading=!0;const{data:a}=await w.getPlans();o.data=a.data,o.isLoading=!1}catch{}}function H(a){o.action=a,Y.value.click()}async function ss(){const a=new FormData;if(o.isLoading=!0,o.action=="create")try{a.append("name",o.formName),a.append("interval",o.formInterval),a.append("currency",o.formCurrency),a.append("price",o.formPrice.replace(/,/g,""));const e=await w.createStripeProduct(a);f.success("Plan Created",{position:"top-right"}),x.value.click(),o.isLoading=!1,console.log(e),U()}catch{f.error("Sorry something went wrong",{position:"top-right"}),x.value.click(),o.isLoading=!1}else try{a.append("name",o.formName),a.append("stripe_product_id","prod_QmYaYdjTcgOOPt");const e=await w.updateStripeProduct(a);f.success("Plan Updated",{position:"top-right"}),x.value.click(),o.isLoading=!1,console.log(e),U()}catch{f.error("Sorry something went wrong",{position:"top-right"}),x.value.click(),o.isLoading=!1}}const ts=[{text:"COMPANY NAME",value:"company_name"},{text:"SUBSCRIPTION STATUS",value:"reg_date"},{text:"BILLING CYCLE",value:"next_billing_cycle"},{text:"LAST PAYMENT DATE",value:"last_payment_date"},{text:"NEXT BILLING DATE",value:"due_date"},{text:"AMOUNT DUE",value:"amount_due"},{text:"PAYMENT STATUS",value:"status"},{text:"INVOICE",value:"invoice_pdf"}];return as(()=>{x.value.click()}),(a,e)=>{var I,c,T,R,j;const _=Q("isLoadingComponent"),u=Q("EasyDataTable");return l(),r(q,null,[s("div",ms,[vs,s("div",bs,[s("div",hs,[s("div",gs,[s("div",fs,[s("div",ys,[s("div",xs,[s("div",ks,[s("div",ws,[s("div",Cs,"Total paid Invoices ("+i(d.paid_invoice??"0")+") ",1),s("div",Is," $"+i(v(b).addCommas(d.paid_invoice_amount)??"0"),1),Ts,Ns]),s("div",Ls,[y.paid?(l(),r("div",Ss,As)):(l(),r("button",{key:1,onClick:e[0]||(e[0]=t=>E("paid")),class:"btn btn-link text-decoration-none btn-sm p-0 float-end"},[Ds,p(" Refresh ")]))])])]),s("div",Es,[s("div",Us,[s("div",Os,[s("div",Ms,"Total Unpaid Invoice ("+i(d.unpaid_invoice??"0")+") ",1),s("div",Bs," $"+i(v(b).addCommas(d.unpaid_invoice_amount)??"0"),1),s("div",$s,"Overdue invoice ("+i(d.overdue_invoices??"0")+") ",1),s("div",Vs,"$"+i(v(b).addCommas(d.overdue_invoices_amount)??"0"),1)]),s("div",Ys,[y.unpaid?(l(),r("div",Hs,js)):(l(),r("button",{key:1,onClick:e[1]||(e[1]=t=>E("unpaid")),class:"btn btn-link text-decoration-none btn-sm p-0 float-end"},[zs,p(" Refresh")]))])])]),s("div",Fs,[s("div",Gs,[s("div",Js,[qs,s("ul",Qs,[s("li",Xs,[Ks,s("span",Ws,i(((I=o.data)==null?void 0:I.plan)??"-"),1)]),s("li",Zs,[st,s("span",tt,i((c=o.data)!=null&&c.amount?v(b).addCommas(o.data.amount):-0),1)]),s("li",et,[ot,s("span",at,i(((T=o.data)==null?void 0:T.recurring)??"-"),1)]),s("li",nt,[it,s("span",dt,i(((R=o.data)==null?void 0:R.currency)??"-"),1)])])]),s("div",lt,[(j=o.data)!=null&&j.stripe_product_id?k((l(),r("button",{key:1,onClick:e[3]||(e[3]=t=>H("update")),class:"btn btn-link text-decoration-none p-0 btn-sm float-end"},[rt,p(" Update plan")],512)),[[F,!o.isLoading]]):k((l(),r("button",{key:0,onClick:e[2]||(e[2]=t=>H("create")),class:"btn btn-link text-decoration-none p-0 btn-sm float-end"},[ct,p(" Create plan")],512)),[[F,!o.isLoading]])])])]),s("div",_t,[s("div",pt,[s("div",ut,[mt,s("ul",vt,[s("li",bt,[ht,s("span",gt,i(d.active_subscriptions),1)]),s("li",ft,[yt,s("span",xt,i(d.cancelled_subscriptions),1)])])]),s("div",kt,[y.subscribers?(l(),r("div",wt,It)):(l(),r("button",{key:1,onClick:e[4]||(e[4]=t=>E("subscribers")),class:"btn btn-link text-decoration-none btn-sm p-0 float-end"},[Tt,p(" Refresh")]))])])])])])])]),s("div",Nt,[s("div",Lt,[s("div",St,[Pt,d.isLoading?(l(),L(_,{key:0})):(l(),L(u,{key:1,class:"easy-data-table","show-index":"",headers:ts,items:d.billingsTable,"buttons-pagination":"","server-options":A.value,"onUpdate:serverOptions":e[5]||(e[5]=t=>A.value=t),"server-items-length":d.totalInvoices},{header:m(t=>[s("span",At,i(t.text=="#"?"S/N":t.text),1)]),"item-status":m(t=>[t.status=="paid"?(l(),r("span",Dt,i(t.status),1)):(l(),r("span",Et,i(t.status),1))]),"item-amount_due":m(t=>[p(i(v(b).addCommas(t.amount_due)),1)]),"item-next_billing_cycle":m(t=>{var h;return[p(i(v(b).dateDisplay((h=t==null?void 0:t.subscription)==null?void 0:h.next_billing_cycle)),1)]}),"item-company_name":m(t=>{var h;return[p(i((h=t==null?void 0:t.subscription)==null?void 0:h.company_name),1)]}),"item-due_date":m(t=>[p(i(v(b).dateDisplay(t.due_date)),1)]),"item-last_payment_date":m(t=>[p(i(v(b).dateDisplay(t.created_at)),1)]),"item-invoice_pdf":m(t=>[t.invoice_pdf?(l(),r("span",Ut,[s("a",{href:t.invoice_pdf,target:"_blank"},Bt,8,Ot),p(" Download Invoive")])):(l(),r("span",$t,"-"))]),_:1},8,["items","server-options","server-items-length"]))])])]),s("div",Vt,[s("div",Yt,[s("div",Ht,[Rt,V.value?(l(),L(_,{key:0})):(l(),L(u,{key:1,class:"easy-data-table","show-index":"",headers:Z,items:$.value,"buttons-pagination":"","server-options":P.value,"onUpdate:serverOptions":e[7]||(e[7]=t=>P.value=t),"server-items-length":B.value},{header:m(t=>[s("span",jt,i(t.text=="#"?"S/N":t.text),1)]),"item-name":m(t=>[p(i(W(t)),1)]),"item-names":m(t=>[p(i(K(t)),1)]),"item-action":m(t=>[s("span",zt,[s("span",Ft,[Gt,s("div",Jt,[s("ul",qt,[s("li",{onClick:e[6]||(e[6]=()=>{}),class:"dropdown-item text-danger",style:{"background-color":"transparent !important"}},[Qt,p(" Delete ")])])])])])]),_:1},8,["items","server-options","server-items-length"]))])])])])]),s("button",{ref_key:"modalOpen",ref:Y,class:"d-none",type:"button","data-bs-toggle":"modal","data-bs-target":"#planModal"},null,512),s("div",Xt,[s("div",Kt,[s("div",Wt,[s("div",Zt,[s("h5",se,i(o.action)+" Plan ",1),s("button",{ref_key:"modalClose",ref:x,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,512)]),s("div",te,[s("div",ee,[s("div",{class:ns(o.action=="create"?"col-lg-6":"col-lg-12")},[oe,k(s("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>o.formName=t),class:"form-control",type:"text"},null,512),[[G,o.formName]])],2),o.action=="create"?(l(),r("div",ae,[ne,k(s("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>o.formPrice=t),class:"form-control",type:"text","data-maska":"9,99#","data-maska-tokens":"9:[0-9]:repeated","data-maska-reversed":""},null,512),[[G,o.formPrice],[v(ps)]])])):O("",!0),o.action=="create"?(l(),r("div",ie,[de,k(s("select",{"onUpdate:modelValue":e[10]||(e[10]=t=>o.formInterval=t),class:"form-select",name:"",id:""},ce,512),[[J,o.formInterval]])])):O("",!0),o.action=="create"?(l(),r("div",re,[_e,k(s("select",{"onUpdate:modelValue":e[11]||(e[11]=t=>o.formCurrency=t),class:"form-select",name:"",id:""},[(l(!0),r(q,null,is(v(us).currencyCodes,(t,h)=>(l(),r("option",{key:h,value:t},i(t),9,pe))),128))],512),[[J,o.formCurrency]])])):O("",!0)])]),s("div",ue,[o.isLoading?(l(),r("button",me,[ve,p(" Loading ")])):(l(),r("button",{key:1,onClick:ss,type:"button",class:"btn btn-primary text-capitalize"},i(o.action)+" plan ",1))])])])])],64)}}}),Ce=cs(be,[["__scopeId","data-v-036fc652"]]);export{Ce as default};
