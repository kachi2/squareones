import{d as ts,p as I,k as os,r as g,l as Y,P as es,o as c,c as r,b as s,t as d,e as m,f as u,w as k,V as H,q as z,s as b,y as as,v as F,g as N,x as G,G as J,H as ns,A as q,C as is,D as ds,_ as ls}from"./index-BRNKKXnK.js";import{a as w}from"./index-BBO9Byvm.js";import{u as cs}from"./adminParamsStore-CcHvX0Z_.js";import{u as h}from"./useFunctions-BPURsnT5.js";import{d as rs}from"./index--usBihGL.js";import{j as _s}from"./maska-Cp-LWreF.js";import{J as us}from"./StartCompany_jsonData-D7IJQ8VJ.js";import"./country-Dh2q9MdB.js";const n=C=>(is("data-v-d4ca8c90"),C=C(),ds(),C),ps={class:"container"},ms=n(()=>s("h5",{class:"fw-bold page-title mb-4"}," Billing",-1)),vs={class:"row g-4"},bs={class:"col-lg-12"},hs={class:"card shadow-sm py-3"},gs={class:"card-body"},ys={class:"row g-3"},fs={class:"col-lg-3 col-md-6"},xs={class:"card h-100 border-grey"},ks={class:"card-body"},ws={class:"small text-grey fw-bold"},Cs={class:"fs-4 text-primary fw-bold"},Is=n(()=>s("div",{class:"small text-grey fw-bold"},"Total in Last 31 Days",-1)),Ls=n(()=>s("div",{class:"fw-bold"},"$0",-1)),Ts={class:"card-footer border-0 bg-transparent"},Ss={key:0,class:"spinner-border text-primary spinner-border-sm float-end",role:"status"},Ps=n(()=>s("span",{class:"visually-hidden"},"Loading...",-1)),Ns=[Ps],As=n(()=>s("i",{class:"bi bi-arrow-clockwise"},null,-1)),Ds={class:"col-lg-3 col-md-6"},Us={class:"card h-100 border-grey"},Es={class:"card-body"},Bs={class:"small text-grey fw-bold"},Ms={class:"fs-4 text-primary fw-bold"},Vs={class:"small text-grey fw-bold"},$s={class:"fw-bold"},Rs={class:"card-footer border-0 bg-transparent"},Ys={key:0,class:"spinner-border text-primary spinner-border-sm float-end",role:"status"},Hs=n(()=>s("span",{class:"visually-hidden"},"Loading...",-1)),zs=[Hs],Fs=n(()=>s("i",{class:"bi bi-arrow-clockwise"},null,-1)),Gs={class:"col-lg-3 col-md-6"},Js={class:"card h-100",style:{border:"1px blue solid !important"}},qs={class:"card-body"},Xs=n(()=>s("div",{class:"fw-bold"},"Plans Subscription",-1)),Ks={class:"list-group list-group-flush xsmall"},Qs={class:"list-group-item p-0 border-0"},Ws=n(()=>s("strong",{class:"text-muted"},"Name:",-1)),Zs={class:"float-end"},Os={class:"list-group-item p-0 border-0"},js=n(()=>s("strong",{class:"text-muted"},"Amount:",-1)),st={class:"float-end"},tt={class:"list-group-item p-0 border-0"},ot=n(()=>s("strong",{class:"text-muted"},"Duration:",-1)),et={class:"float-end"},at={class:"list-group-item p-0 border-0"},nt=n(()=>s("strong",{class:"text-muted"},"Currency:",-1)),it={class:"float-end"},dt={class:"card-footer border-0 bg-transparent"},lt=n(()=>s("i",{class:"bi bi-plus-lg"},null,-1)),ct=n(()=>s("i",{class:"bi bi-pencil"},null,-1)),rt={class:"col-lg-3 col-md-6"},_t={class:"card h-100",style:{border:"1px blue solid !important"}},ut={class:"card-body"},pt=n(()=>s("div",{class:"fw-bold"},"Subscriptions",-1)),mt={class:"list-group list-group-flush xsmall"},vt={class:"list-group-item p-0 border-0"},bt=n(()=>s("strong",{class:"text-muted"},"Active Subcriptions:",-1)),ht={class:"float-end badge bg-success-subtle text-dark"},gt={class:"list-group-item p-0 border-0"},yt=n(()=>s("strong",{class:"text-muted"},"Cancelled subscriptions:",-1)),ft={class:"float-end badge bg-danger-subtle text-dark"},xt={class:"card-footer border-0 bg-transparent"},kt={key:0,class:"spinner-border text-primary spinner-border-sm float-end",role:"status"},wt=n(()=>s("span",{class:"visually-hidden"},"Loading...",-1)),Ct=[wt],It=n(()=>s("i",{class:"bi bi-arrow-clockwise"},null,-1)),Lt={class:"col-12 mt-4"},Tt={class:"card shadow-sm min-vh-100"},St={class:"card-body"},Pt=n(()=>s("div",{class:"card-header fw-bold bg-transparent border-0 px-0 py-3"}," Billing Table ",-1)),Nt={class:"fw-bold text-muted"},At={key:0,class:"badge bg-success-subtle text-dark"},Dt={key:1,class:"badge bg-secondary-subtle text-dark"},Ut={key:0,class:"badge bg-success-subtle text-dark"},Et={key:1,class:"badge bg-secondary-subtle text-dark"},Bt={key:0,class:"text-nowrap"},Mt=["href"],Vt=n(()=>s("strong",null," View Details",-1)),$t=[Vt],Rt={key:1},Yt={class:"modal fade",id:"planModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false",role:"dialog","aria-labelledby":"modalTitleId","aria-hidden":"true"},Ht={class:"modal-dialog modal-dialog-scrollable modal-dialog-centered",role:"document"},zt={class:"modal-content"},Ft={class:"modal-header text-capitalize border-0"},Gt={class:"modal-title",id:"modalTitleId"},Jt={class:"modal-body"},qt={class:"row g-3"},Xt=n(()=>s("div",{class:"form-label"},"Name",-1)),Kt={key:0,class:"col-lg-6"},Qt=n(()=>s("div",{class:"form-label"},"Amount",-1)),Wt={key:1,class:"col-lg-6"},Zt=n(()=>s("div",{class:"form-label"},"Duration",-1)),Ot=n(()=>s("option",{value:"year",selected:""},"Year",-1)),jt=[Ot],so={key:2,class:"col-lg-6"},to=n(()=>s("div",{class:"form-label"},"Currency",-1)),oo=["value"],eo={class:"modal-footer border-0"},ao={key:0,class:"btn btn-primary",type:"button",disabled:""},no=n(()=>s("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),io=ts({__name:"AdminBillings",setup(C){const X=cs(),y=rs.useToast(),K=I({list:[]});os(()=>{A(),T(),P()});async function A(){try{const a=(await w.getAllBillings(X.currentCompanyId)).data.data;W.value=a.total,Z.value=a.data,K.list=a.data,O.value=!1}catch(i){console.log(i)}}const Q=g({page:1,rowsPerPage:15}),L=g({page:1,rowsPerPage:15}),W=g(0),Z=g([]),O=g(!0);Y(Q,i=>{A()},{deep:!0}),Y(L,i=>{T()},{deep:!0});const l=I({isLoading:!0,total_invoices:0,total_invoice_amount:0,unpaid_invoice:0,unpaid_invoice_amount:0,paid_invoice:0,paid_invoice_amount:0,overdue_invoices:0,overdue_invoices_amount:0,active_subscriptions:0,cancelled_subscriptions:0,invoice_paid_this_monthly:0,invoice_unpaid_monthly_amount:0,invoice_paid_monthly_amount:0,invoice_unpaid_monthly:0,billingsTable:[],totalInvoices:0});async function T(){var i,a;try{const{data:_}=await w.getInvoices(),e=(i=_.data)==null?void 0:i.subscription_summary,v=(a=_==null?void 0:_.data)==null?void 0:a.invoices;l.billingsTable=(v==null?void 0:v.data)??[],l.totalInvoices=(v==null?void 0:v.total)??0,l.total_invoices=e==null?void 0:e.total_invoices,l.total_invoice_amount=e==null?void 0:e.total_invoice_amount,l.unpaid_invoice=e==null?void 0:e.unpaid_invoice,l.unpaid_invoice_amount=e==null?void 0:e.unpaid_invoice_amount,l.paid_invoice=e==null?void 0:e.paid_invoice,l.paid_invoice_amount=e==null?void 0:e.paid_invoice_amount,l.overdue_invoices=e==null?void 0:e.overdue_invoices,l.overdue_invoices_amount=e==null?void 0:e.overdue_invoices_amount,l.active_subscriptions=e==null?void 0:e.active_subscriptions,l.cancelled_subscriptions=e==null?void 0:e.cancelled_subscriptions,l.isLoading=!1}catch(_){console.log(_)}}const f=I({paid:!1,unpaid:!1,subscribers:!1});async function S(i){f[i]=!0;try{await T(),y.success("Invoice Updated",{position:"top-right"}),f[i]=!1}catch{y.error("Error, Something went wrong",{position:"top-right"}),f[i]=!1}}const o=I({data:null,action:"create",isLoading:!1,formName:"",formPrice:"",formInterval:"year",formCurrency:"USD"}),D=g(null),x=g(null);async function P(){try{o.isLoading=!0;const{data:i}=await w.getPlans();o.data=i.data,o.isLoading=!1}catch{}}function U(i){o.action=i,D.value.click()}async function j(){var a;const i=new FormData;if(o.isLoading=!0,o.action=="create")try{i.append("name",o.formName),i.append("interval",o.formInterval),i.append("currency",o.formCurrency),i.append("price",o.formPrice.replace(/,/g,""));const _=await w.createStripeProduct(i);y.success("Plan Created",{position:"top-right"}),x.value.click(),o.isLoading=!1,P()}catch{y.error("Sorry something went wrong",{position:"top-right"}),x.value.click(),o.isLoading=!1}else try{i.append("name",o.formName),i.append("stripe_product_id",(a=o==null?void 0:o.data)==null?void 0:a.stripe_product_id);const _=await w.updateStripeProduct(i);y.success("Plan Updated",{position:"top-right"}),x.value.click(),o.isLoading=!1,P()}catch{y.error("Sorry something went wrong",{position:"top-right"}),x.value.click(),o.isLoading=!1}}const ss=[{text:"COMPANY NAME",value:"company_name"},{text:"SUBSCRIPTION STATUS",value:"reg_date"},{text:"BILLING CYCLE",value:"next_billing_cycle"},{text:"LAST PAYMENT DATE",value:"last_payment_date"},{text:"NEXT BILLING DATE",value:"next_billing_cycle"},{text:"AMOUNT DUE",value:"amount_due"},{text:"PAYMENT STATUS",value:"status"},{text:"INVOICE",value:"hosted_invoice_url"}];return es(()=>{x.value.click()}),(i,a)=>{var v,E,B,M,V;const _=q("isLoadingComponent"),e=q("EasyDataTable");return c(),r(J,null,[s("div",ps,[ms,s("div",vs,[s("div",bs,[s("div",hs,[s("div",gs,[s("div",ys,[s("div",fs,[s("div",xs,[s("div",ks,[s("div",ws,"Total paid Invoices ("+d(l.paid_invoice??"0")+") ",1),s("div",Cs," $"+d(m(h).addCommas(l.paid_invoice_amount)??"0"),1),Is,Ls]),s("div",Ts,[f.paid?(c(),r("div",Ss,Ns)):(c(),r("button",{key:1,onClick:a[0]||(a[0]=t=>S("paid")),class:"btn btn-link text-decoration-none btn-sm p-0 float-end"},[As,u(" Refresh ")]))])])]),s("div",Ds,[s("div",Us,[s("div",Es,[s("div",Bs,"Total Unpaid Invoice ("+d(l.unpaid_invoice??"0")+") ",1),s("div",Ms," $"+d(m(h).addCommas(l.unpaid_invoice_amount)??"0"),1),s("div",Vs,"Overdue invoice ("+d(l.overdue_invoices??"0")+") ",1),s("div",$s,"$"+d(m(h).addCommas(l.overdue_invoices_amount)??"0"),1)]),s("div",Rs,[f.unpaid?(c(),r("div",Ys,zs)):(c(),r("button",{key:1,onClick:a[1]||(a[1]=t=>S("unpaid")),class:"btn btn-link text-decoration-none btn-sm p-0 float-end"},[Fs,u(" Refresh")]))])])]),s("div",Gs,[s("div",Js,[s("div",qs,[Xs,s("ul",Ks,[s("li",Qs,[Ws,s("span",Zs,d(((v=o.data)==null?void 0:v.plan)??"-"),1)]),s("li",Os,[js,s("span",st,d((E=o.data)!=null&&E.amount?m(h).addCommas(o.data.amount):-0),1)]),s("li",tt,[ot,s("span",et,d(((B=o.data)==null?void 0:B.recurring)??"-"),1)]),s("li",at,[nt,s("span",it,d(((M=o.data)==null?void 0:M.currency)??"-"),1)])])]),s("div",dt,[(V=o.data)!=null&&V.stripe_product_id?k((c(),r("button",{key:1,onClick:a[3]||(a[3]=t=>U("update")),class:"btn btn-link text-decoration-none p-0 btn-sm float-end"},[ct,u(" Update plan")],512)),[[H,!o.isLoading]]):k((c(),r("button",{key:0,onClick:a[2]||(a[2]=t=>U("create")),class:"btn btn-link text-decoration-none p-0 btn-sm float-end"},[lt,u(" Create plan")],512)),[[H,!o.isLoading]])])])]),s("div",rt,[s("div",_t,[s("div",ut,[pt,s("ul",mt,[s("li",vt,[bt,s("span",ht,d(l.active_subscriptions),1)]),s("li",gt,[yt,s("span",ft,d(l.cancelled_subscriptions),1)])])]),s("div",xt,[f.subscribers?(c(),r("div",kt,Ct)):(c(),r("button",{key:1,onClick:a[4]||(a[4]=t=>S("subscribers")),class:"btn btn-link text-decoration-none btn-sm p-0 float-end"},[It,u(" Refresh")]))])])])])])])]),s("div",Lt,[s("div",Tt,[s("div",St,[Pt,l.isLoading?(c(),z(_,{key:0})):(c(),z(e,{key:1,class:"easy-data-table","show-index":"",headers:ss,items:l.billingsTable,"buttons-pagination":"","server-options":L.value,"onUpdate:serverOptions":a[5]||(a[5]=t=>L.value=t),"server-items-length":l.totalInvoices},{header:b(t=>[s("span",Nt,d(t.text=="#"?"S/N":t.text),1)]),"item-reg_date":b(t=>{var p,$,R;return[((p=t==null?void 0:t.subscription)==null?void 0:p.status)=="active"?(c(),r("span",At,d(($=t==null?void 0:t.subscription)==null?void 0:$.status),1)):(c(),r("span",Dt,d((R=t==null?void 0:t.subscription)==null?void 0:R.status),1))]}),"item-status":b(t=>[t.status=="paid"?(c(),r("span",Ut,d(t.status),1)):(c(),r("span",Et,d(t.status),1))]),"item-amount_due":b(t=>[u(d(m(h).addCommas(t.amount_due)),1)]),"item-next_billing_cycle":b(t=>{var p;return[u(d(m(h).dateDisplay((p=t==null?void 0:t.subscription)==null?void 0:p.next_billing_cycle)),1)]}),"item-company_name":b(t=>{var p;return[u(d((p=t==null?void 0:t.subscription)==null?void 0:p.company_name),1)]}),"item-due_date":b(t=>[u(d(m(h).dateDisplay(t.due_date)),1)]),"item-last_payment_date":b(t=>[u(d(m(h).dateDisplay(t.created_at)),1)]),"item-hosted_invoice_url":b(t=>[t.hosted_invoice_url?(c(),r("span",Bt,[s("a",{href:t.hosted_invoice_url,target:"_blank",style:{"text-decoration":"none"}},$t,8,Mt)])):(c(),r("span",Rt,"-"))]),_:1},8,["items","server-options","server-items-length"]))])])])])]),s("button",{ref_key:"modalOpen",ref:D,class:"d-none",type:"button","data-bs-toggle":"modal","data-bs-target":"#planModal"},null,512),s("div",Yt,[s("div",Ht,[s("div",zt,[s("div",Ft,[s("h5",Gt,d(o.action)+" Plan ",1),s("button",{ref_key:"modalClose",ref:x,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,512)]),s("div",Jt,[s("div",qt,[s("div",{class:as(o.action=="create"?"col-lg-6":"col-lg-12")},[Xt,k(s("input",{"onUpdate:modelValue":a[6]||(a[6]=t=>o.formName=t),class:"form-control",type:"text"},null,512),[[F,o.formName]])],2),o.action=="create"?(c(),r("div",Kt,[Qt,k(s("input",{"onUpdate:modelValue":a[7]||(a[7]=t=>o.formPrice=t),class:"form-control",type:"text","data-maska":"9,99#","data-maska-tokens":"9:[0-9]:repeated","data-maska-reversed":""},null,512),[[F,o.formPrice],[m(_s)]])])):N("",!0),o.action=="create"?(c(),r("div",Wt,[Zt,k(s("select",{"onUpdate:modelValue":a[8]||(a[8]=t=>o.formInterval=t),class:"form-select",name:"",id:""},jt,512),[[G,o.formInterval]])])):N("",!0),o.action=="create"?(c(),r("div",so,[to,k(s("select",{"onUpdate:modelValue":a[9]||(a[9]=t=>o.formCurrency=t),class:"form-select",name:"",id:""},[(c(!0),r(J,null,ns(m(us).currencyCodes,(t,p)=>(c(),r("option",{key:p,value:t},d(t),9,oo))),128))],512),[[G,o.formCurrency]])])):N("",!0)])]),s("div",eo,[o.isLoading?(c(),r("button",ao,[no,u(" Loading ")])):(c(),r("button",{key:1,onClick:j,type:"button",class:"btn btn-primary text-capitalize"},d(o.action)+" plan ",1))])])])])],64)}}}),bo=ls(io,[["__scopeId","data-v-d4ca8c90"]]);export{bo as default};
