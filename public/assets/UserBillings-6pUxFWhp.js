import{d as ss,M as ts,k as es,p as D,r,l as as,n as os,P as ns,o as i,c as d,b as s,t as n,e as m,f as c,B as ls,s as p,w as is,x as ds,G as E,H as cs,y as rs,g as T,A as us,C as _s,D as ps,_ as bs}from"./index-C45QP7u5.js";import{a as y}from"./index-B5tPDbHl.js";import{u as ms}from"./paramsStore-CT89GkHm.js";import{u as h}from"./useFunctions-DBQkSSvL.js";import{d as ys}from"./index-C1VTtF-D.js";const o=v=>(_s("data-v-c8b9e5c9"),v=v(),ps(),v),hs={class:"container"},vs={class:"row g-4"},gs={class:"col-lg-12"},fs={class:"card shadow-sm py-3"},xs={class:"card-body"},Ss={class:"row g-3"},ks={class:"col-lg-3 col-md-6"},ws={class:"card h-100 border-grey"},Ps={class:"card-body"},Cs=o(()=>s("div",{class:"small text-grey fw-bold"},"Pending Renewal",-1)),Ds=o(()=>s("div",{class:"fs-4 text-primary fw-bold"},"0",-1)),Es=o(()=>s("div",{class:"small text-grey fw-bold"},"Next renewal date:",-1)),Ts={class:"fw-bold"},Is={class:"col-lg-3 col-md-6"},Ms={class:"card h-100 border-grey"},Ls={class:"card-body"},Ns=o(()=>s("div",{class:"small text-grey fw-bold"},"Total Payments made:",-1)),Bs={class:"fs-4 text-primary fw-bold"},As=o(()=>s("div",{class:"small text-grey fw-bold"},"last payment date:",-1)),Os={class:"fw-bold"},Us={class:"col-lg-3 col-md-6"},qs={class:"card h-100",style:{border:"1px blue solid !important"}},Rs={class:"card-body pb-1"},Vs=o(()=>s("div",{class:"fw-bold"},"Card details",-1)),Fs={class:"text-grey fw-bold text-capitalize"},Ys={class:"text-grey fw-bold"},Gs={class:"text-grey fw-bold"},Hs=o(()=>s("i",{class:"bi bi-pencil"},null,-1)),js={class:"col-lg-3 col-md-6"},zs={class:"card h-100",style:{border:"1px blue solid !important"}},Ks={class:"card-body pb-1"},Ws={class:"fw-bold"},Xs={class:"list-group list-group-flush xsmall"},Zs={class:"list-group-item p-0 border-0"},$s=o(()=>s("strong",{class:"text-muted"},"Active Suscriptions:",-1)),Js={class:"float-end badge bg-success-subtle text-dark"},Qs={class:"list-group-item p-0 border-0"},st=o(()=>s("strong",{class:"text-muted"},"Paused Suscriptions:",-1)),tt={class:"float-end badge bg-danger-subtle text-dark"},et=o(()=>s("i",{class:"bi bi-gear-wide"},null,-1)),at={class:"col-12 mt-4"},ot={class:"card"},nt=o(()=>s("div",{class:"fw-bold mb-2 p-3"},"Billing History",-1)),lt={class:"card-body"},it={class:"fw-bold text-muted"},dt={key:0,class:"badge bg-success-subtle text-dark"},ct={key:1,class:"badge bg-secondary-subtle text-dark"},rt={key:0,class:"badge bg-success-subtle text-dark"},ut={key:1,class:"badge bg-secondary-subtle text-dark"},_t={key:0,class:"text-nowrap"},pt=["href"],bt=o(()=>s("i",{class:"bi bi-file-arrow-down-fill"},null,-1)),mt=o(()=>s("strong",null," DOWNLOAD",-1)),yt=[bt,mt],ht={key:1},vt={class:"modal fade",id:"subscriptionModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false",role:"dialog","aria-labelledby":"modalTitleId","aria-hidden":"true"},gt={class:"modal-dialog modal-dialog-scrollable modal-dialog-centered",role:"document"},ft={class:"modal-content"},xt={class:"modal-header border-0"},St=o(()=>s("h5",{class:"modal-title",id:"modalTitleId"}," Subscription Plan ",-1)),kt={class:"modal-body"},wt={class:"row g-3"},Pt={class:"col-12"},Ct=o(()=>s("div",{for:"",class:"form-label"},"Select Plan",-1)),Dt=["value"],Et={class:"modal-footer border-0"},Tt={key:0,class:"btn btn-secondary",type:"button",disabled:""},It=o(()=>s("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),Mt={key:0},Lt={class:"modal fade",id:"cardDetailsModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false",role:"dialog","aria-labelledby":"modalTitleId","aria-hidden":"true"},Nt={class:"modal-dialog modal-dialog-scrollable modal-dialog-centered",role:"document"},Bt={class:"modal-content"},At={class:"modal-header"},Ot=o(()=>s("h5",{class:"modal-title",id:"modalTitleId"}," Card Details ",-1)),Ut={class:"modal-body"},qt={key:0,class:"text-center text-danger mt-5"},Rt=o(()=>s("strong",null,"Error!",-1)),Vt=o(()=>s("hr",null,null,-1)),Ft={key:1},Yt={class:"row justify-content-center"},Gt={id:"payment-form"},Ht=o(()=>s("div",{id:"payment-element"},null,-1)),jt={key:0,class:"form-check"},zt=o(()=>s("input",{class:"form-check-input exemption",type:"checkbox",value:"",id:"checker"},null,-1)),Kt=o(()=>s("label",{class:"form-check-label",for:"checker"},[s("div",{class:"fw-bol"}," Securely save my information for 1-click checkout ")],-1)),Wt=[zt,Kt],Xt=o(()=>s("div",{id:"payment-message",class:"hidden"},null,-1)),Zt={class:"col-12 mt-4"},$t=o(()=>s("button",{type:"button",class:"btn btn-secondary me-2","data-bs-dismiss":"modal"}," Close ",-1)),Jt={key:0,id:"submit",class:"btn btn-primary"},Qt=o(()=>s("div",{class:"spinner hidden",id:"spinner"},null,-1)),se=o(()=>s("span",{id:"button-text"},"Update Card Details",-1)),te=[Qt,se],ee=o(()=>s("div",{class:"modal-footer"},null,-1)),ae="pk_test_51P7LhqRxBSKsFyqbPdmjZpG4tFsnyLZEV6Tn38aic7H4oeWOSub5gTRnjF4vgdRbBJutMM0G3d2x3c9VFz2g1dkX00bPRK5pYT",oe=ss({__name:"UserBillings",setup(v){ms();const g=ys.useToast(),f=ts();es(()=>{L(),I(),K(),M()});const u=D({card_name:"",card_no:"",country:"",expiry:"",email:"",name:""}),_=D({plan_name:"",expiry_date:"",amount_paid:"",payment_id:"",duration:""}),l=D({active_subs:[],cancelled_subs:[],subscription:[],isSaving:!1,seletedSubPlan:null});async function I(){try{const t=(await y.getPaymentInfo()).data;u.card_name=t.card_name,u.card_no=t.card_no,u.country=t.country,u.expiry=t.expiry,u.email=t.email,u.name=t.name}catch{}}async function K(){try{const t=(await y.getUserSubscription()).data;_.plan_name=t.plans.plan,_.expiry_date=t.expiry_date,_.amount_paid=t.amount_paid,_.payment_id=t.payment_id,_.duration=t.plans.duration+" Days",_.last_paid=t.plans.created_at}catch(a){console.log(a)}}async function M(){try{const t=(await y.getUserSubscriptionPlan()).data;l.active_subs=(t==null?void 0:t.active_subs)??[],l.cancelled_subs=(t==null?void 0:t.cancelled_subs)??[],l.subscription=(t==null?void 0:t.subscription)??[]}catch{}}async function L(){try{const{data:a}=await y.userInvoices(),t=a==null?void 0:a.invoice;N.value=(t==null?void 0:t.total)??0,B.value=(t==null?void 0:t.data)??[],S.value=!1}catch{S.value=!1}}const x=r({page:1,rowsPerPage:15}),N=r(0),B=r([]),S=r(!0),W=[{text:"COMPANY NAME",value:"company_name"},{text:"SUBSCRIPTION STATUS",value:"reg_date"},{text:"BILLING CYCLE",value:"next_billing_cycle"},{text:"LAST PAYMENT DATE",value:"last_payment_date"},{text:"NEXT BILLING DATE",value:"due_date"},{text:"AMOUNT DUE",value:"amount_due"},{text:"PAYMENT STATUS",value:"status"},{text:"INVOICE",value:"invoice_pdf"}];as(x,a=>{L()},{deep:!0});const A=r(null),k=r(null);function X(){l.seletedSubPlan=null,A.value.click()}async function O(a){try{l.isSaving=!0;const t=a=="pause"?await y.pauseSubscriptionPlan(l.seletedSubPlan.subscription_id):await y.resumeSubscriptionPlan(l.seletedSubPlan.subscription_id);console.log(t,"ssssssss"),g.success("Subcription Plan updated",{position:"top-right"}),M(),k.value.click(),l.isSaving=!1}catch{g.error("Sorry something went wrong",{position:"top-right"}),l.isSaving=!1}}const U=r(null),q=r(null);async function Z(){await $(),U.value.click()}const R=Stripe(ae);let V="",w="";const P=r(!1),C=r(!1);async function $(){try{C.value=!1;const{data:a}=await y.upateCardInfo();V=a.client_secret,a!=null&&a.client_secret&&(P.value=!0),w=R.elements({clientSecret:V});const t={layout:"tabs"};w.create("payment",t).mount("#payment-element"),document.querySelector("#payment-form"),document.addEventListener("submit",J)}catch(a){console.log(a),C.value=!0}}async function J(a){a.preventDefault(),Y(!0);const{error:t}=await R.confirmPayment({elements:w,confirmParams:{return_url:window.location.href}});t.type==="card_error"||t.type==="validation_error"?F(t.message):F("An unexpected error occurred."),Y(!1)}function F(a){const t=document.querySelector("#payment-message");t.classList.remove("hidden"),t.textContent=a,setTimeout(function(){t.classList.add("hidden"),t.textContent=""},4e3)}function Y(a){a?(document.querySelector("#submit").disabled=!0,document.querySelector("#spinner").classList.remove("hidden"),document.querySelector("#button-text").classList.add("hidden")):(document.querySelector("#submit").disabled=!1,document.querySelector("#spinner").classList.add("hidden"),document.querySelector("#button-text").classList.remove("hidden"))}os(()=>{var a;(a=f==null?void 0:f.query)!=null&&a.payment_intent&&Q(f.query.payment_intent)});async function Q(a){try{const t=await y.makeDefaultPament(a);I(),g.success("Card details updated",{position:"top-right"})}catch{g.error("Sorry, Something went wrong",{position:"top-right"})}}return ns(()=>{k.value.click(),q.value.click()}),(a,t)=>{var H;const G=us("EasyDataTable");return i(),d(E,null,[s("div",hs,[s("div",vs,[s("div",gs,[s("div",fs,[s("div",xs,[s("div",Ss,[s("div",ks,[s("div",ws,[s("div",Ps,[Cs,Ds,Es,s("div",Ts,n(m(h).dateDisplay(_.expiry_date)),1)])])]),s("div",Is,[s("div",Ms,[s("div",Ls,[Ns,s("div",Bs,n(m(h).addCommas(_.amount_paid)),1),As,s("div",Os,n(m(h).dateDisplay(_.last_paid)),1)])])]),s("div",Us,[s("div",qs,[s("div",Rs,[Vs,s("div",Fs,[c(" Name: "),s("span",null,n(u.card_name??"***"),1)]),s("div",Ys,[c(" Number: "),s("span",null,"**** **** ****"+n(u.card_no??""),1)]),s("div",Gs,[c(" Expiry: "),s("span",null,n(u.expiry??"***"),1)])]),s("div",{class:"card-footer pt-0 border-0 bg-transparent"},[s("a",{onClick:Z,href:"#",class:"small fw-bold"},[Hs,c(" Edit Card deatils ")])])])]),s("div",js,[s("div",zs,[s("div",Ks,[s("div",Ws,"Subscription Plans ("+n(l.subscription.length)+") ",1),s("ul",Xs,[s("li",Zs,[$s,s("span",Js,n(l.active_subs.length),1)]),s("li",Qs,[st,s("span",tt,n(l.cancelled_subs.length),1)])])]),s("div",{class:"card-footer pt-0 border-0 bg-transparent"},[s("a",{href:"#",onClick:X,class:"small fw-bold"},[et,c(" Manage Subscription")])])])])])])])]),s("div",at,[s("div",ot,[nt,s("div",lt,[ls(G,{loading:S.value,class:"easy-data-table","show-index":"",headers:W,items:B.value,"buttons-pagination":"","server-options":x.value,"onUpdate:serverOptions":t[0]||(t[0]=e=>x.value=e),"server-items-length":N.value},{header:p(e=>[s("span",it,n(e.text=="#"?"S/N":e.text),1)]),"item-reg_date":p(e=>{var b,j,z;return[((b=e==null?void 0:e.subscription)==null?void 0:b.status)=="active"?(i(),d("span",dt,n((j=e==null?void 0:e.subscription)==null?void 0:j.status),1)):(i(),d("span",ct,n((z=e==null?void 0:e.subscription)==null?void 0:z.status),1))]}),"item-status":p(e=>[e.status=="paid"?(i(),d("span",rt,n(e.status),1)):(i(),d("span",ut,n(e.status),1))]),"item-amount_due":p(e=>[c(n(m(h).addCommas(e.amount_due)),1)]),"item-due_date":p(e=>[c(n(m(h).dateDisplay(e.due_date)),1)]),"item-next_billing_cycle":p(e=>{var b;return[c(n(m(h).dateDisplay((b=e==null?void 0:e.subscription)==null?void 0:b.next_billing_cycle)),1)]}),"item-company_name":p(e=>{var b;return[c(n((b=e==null?void 0:e.subscription)==null?void 0:b.company_name),1)]}),"item-last_payment_date":p(e=>[c(n(m(h).dateDisplay(e.created_at)),1)]),"item-invoice_pdf":p(e=>[e.invoice_pdf?(i(),d("span",_t,[s("a",{href:e.invoice_pdf,target:"_blank"},yt,8,pt)])):(i(),d("span",ht,"-"))]),_:1},8,["loading","items","server-options","server-items-length"])])])])])]),s("button",{ref_key:"subscriptionPlanModalOpen",ref:A,type:"button",class:"btn d-none","data-bs-toggle":"modal","data-bs-target":"#subscriptionModal"},null,512),s("div",vt,[s("div",gt,[s("div",ft,[s("div",xt,[St,s("button",{ref_key:"subscriptionPlanModalClose",ref:k,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,512)]),s("div",kt,[s("div",wt,[s("div",Pt,[Ct,is(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>l.seletedSubPlan=e),class:"form-select"},[(i(!0),d(E,null,cs(l.subscription,e=>(i(),d("option",{class:rs({"text-success-emphasis":e.status=="active"}),value:e,key:e.id},n(e.company_name??"-")+" (next billing cycle: "+n(m(h).dateDisplay(e.next_billing_cycle))+") ",11,Dt))),128))],512),[[ds,l.seletedSubPlan]])])])]),s("div",Et,[l.isSaving?(i(),d("button",Tt,[It,c(" Loading ")])):(i(),d(E,{key:1},[l.seletedSubPlan?(i(),d("div",Mt,[((H=l.seletedSubPlan)==null?void 0:H.status)=="active"?(i(),d("button",{key:0,onClick:t[2]||(t[2]=e=>O("pause")),type:"button",class:"btn btn-danger"},"Pause Subscription")):(i(),d("button",{key:1,onClick:t[3]||(t[3]=e=>O("resume")),type:"button",class:"btn btn-success"},"Resume Subscription"))])):T("",!0)],64))])])])]),s("button",{ref_key:"cardDetailsModalOpen",ref:U,type:"button",class:"btn d-none","data-bs-toggle":"modal","data-bs-target":"#cardDetailsModal"},null,512),s("div",Lt,[s("div",Nt,[s("div",Bt,[s("div",At,[Ot,s("button",{ref_key:"cardDetailsModalClose",ref:q,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,512)]),s("div",Ut,[C.value?(i(),d("div",qt,[Rt,c(" loading payment information, please refresh page. "),Vt])):(i(),d("div",Ft,[s("div",Yt,[s("form",Gt,[Ht,P.value?(i(),d("div",jt,Wt)):T("",!0),Xt,s("div",Zt,[$t,P.value?(i(),d("button",Jt,te)):T("",!0)])])])]))]),ee])])])],64)}}}),re=bs(oe,[["__scopeId","data-v-c8b9e5c9"]]);export{re as default};
