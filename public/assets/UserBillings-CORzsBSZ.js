import{d as ts,M as es,k as as,p as E,r,l as os,n as ns,P as ls,o as i,c as d,b as s,t as n,e as m,f as c,B as is,s as p,w as ds,x as cs,G as T,H as rs,y as us,g as I,A as _s,C as ps,D as bs,_ as ms}from"./index-C0wR_aM1.js";import{a as y}from"./index-Bc27vxtU.js";import{u as ys}from"./paramsStore-BL_dQJjH.js";import{u as h}from"./useFunctions-CfmAuQlA.js";import{d as hs}from"./index-af_oULFB.js";const o=v=>(ps("data-v-eb41ec39"),v=v(),bs(),v),vs={class:"container"},gs={class:"row g-4"},fs={class:"col-lg-12"},xs={class:"card shadow-sm py-3"},Ss={class:"card-body"},ks={class:"row g-3"},ws={class:"col-lg-3 col-md-6"},Ps={class:"card h-100 border-grey"},Cs={class:"card-body"},Ds=o(()=>s("div",{class:"small text-grey fw-bold"},"Pending Renewal",-1)),Es=o(()=>s("div",{class:"fs-4 text-primary fw-bold"},"0",-1)),Ts=o(()=>s("div",{class:"small text-grey fw-bold"},"Next renewal date:",-1)),Is={class:"fw-bold"},Ms={class:"col-lg-3 col-md-6"},Ls={class:"card h-100 border-grey"},Ns={class:"card-body"},Bs=o(()=>s("div",{class:"small text-grey fw-bold"},"Total Payments made:",-1)),As={class:"fs-4 text-primary fw-bold"},Us=o(()=>s("div",{class:"small text-grey fw-bold"},"last payment date:",-1)),qs={class:"fw-bold"},Os={class:"col-lg-3 col-md-6"},Rs={class:"card h-100",style:{border:"1px blue solid !important"}},Vs={class:"card-body pb-1"},Fs=o(()=>s("div",{class:"fw-bold"},"Card details",-1)),Ys={class:"text-grey fw-bold text-capitalize"},Gs={class:"text-grey fw-bold"},Hs={class:"text-grey fw-bold"},zs=o(()=>s("i",{class:"bi bi-pencil"},null,-1)),js={class:"col-lg-3 col-md-6"},Ks={class:"card h-100",style:{border:"1px blue solid !important"}},Xs={class:"card-body pb-1"},Zs={class:"fw-bold"},$s={class:"list-group list-group-flush xsmall"},Js={class:"list-group-item p-0 border-0"},Ws=o(()=>s("strong",{class:"text-muted"},"Active Suscriptions:",-1)),Qs={class:"float-end badge bg-success-subtle text-dark"},st={class:"list-group-item p-0 border-0"},tt=o(()=>s("strong",{class:"text-muted"},"Paused Suscriptions:",-1)),et={class:"float-end badge bg-danger-subtle text-dark"},at=o(()=>s("i",{class:"bi bi-gear-wide"},null,-1)),ot={class:"col-12 mt-4"},nt={class:"card"},lt=o(()=>s("div",{class:"fw-bold mb-2 p-3"},"Billing History",-1)),it={class:"card-body"},dt={class:"fw-bold text-muted"},ct={key:0,class:"badge bg-success-subtle text-dark"},rt={key:1,class:"badge bg-secondary-subtle text-dark"},ut={key:0,class:"badge bg-success-subtle text-dark"},_t={key:1,class:"badge bg-secondary-subtle text-dark"},pt={key:0,class:"text-nowrap"},bt=["href"],mt=o(()=>s("strong",null," View Details",-1)),yt=[mt],ht={key:1},vt={class:"modal fade",id:"subscriptionModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false",role:"dialog","aria-labelledby":"modalTitleId","aria-hidden":"true"},gt={class:"modal-dialog modal-dialog-scrollable modal-dialog-centered",role:"document"},ft={class:"modal-content"},xt={class:"modal-header border-0"},St=o(()=>s("h5",{class:"modal-title",id:"modalTitleId"}," Subscription Plan ",-1)),kt={class:"modal-body"},wt={class:"row g-3"},Pt={class:"col-12"},Ct=o(()=>s("div",{for:"",class:"form-label"},"Select Plan",-1)),Dt=["value"],Et={class:"modal-footer border-0"},Tt={key:0,class:"btn btn-secondary",type:"button",disabled:""},It=o(()=>s("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),Mt={key:0},Lt={class:"modal fade",id:"cardDetailsModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false",role:"dialog","aria-labelledby":"modalTitleId","aria-hidden":"true"},Nt={class:"modal-dialog modal-dialog-scrollable modal-dialog-centered",role:"document"},Bt={class:"modal-content"},At={class:"modal-header"},Ut=o(()=>s("h5",{class:"modal-title",id:"modalTitleId"}," Card Details ",-1)),qt={class:"modal-body"},Ot={key:0,class:"text-center text-danger mt-5"},Rt=o(()=>s("strong",null,"Error!",-1)),Vt=o(()=>s("hr",null,null,-1)),Ft={key:1},Yt={class:"row justify-content-center"},Gt={id:"payment-form"},Ht=o(()=>s("div",{id:"payment-element"},null,-1)),zt={key:0,class:"form-check"},jt=o(()=>s("input",{class:"form-check-input exemption",type:"checkbox",value:"",id:"checker"},null,-1)),Kt=o(()=>s("label",{class:"form-check-label",for:"checker"},[s("div",{class:"fw-bol"}," Securely save my information for 1-click checkout ")],-1)),Xt=[jt,Kt],Zt=o(()=>s("div",{id:"payment-message",class:"hidden"},null,-1)),$t={class:"col-12 mt-4"},Jt=o(()=>s("button",{type:"button",class:"btn btn-secondary me-2","data-bs-dismiss":"modal"}," Close ",-1)),Wt={key:0,id:"submit",class:"btn btn-primary"},Qt=o(()=>s("div",{class:"spinner hidden",id:"spinner"},null,-1)),se=o(()=>s("span",{id:"button-text"},"Update Card Details",-1)),te=[Qt,se],ee=o(()=>s("div",{class:"modal-footer"},null,-1)),ae="pk_test_51P7LhqRxBSKsFyqbPdmjZpG4tFsnyLZEV6Tn38aic7H4oeWOSub5gTRnjF4vgdRbBJutMM0G3d2x3c9VFz2g1dkX00bPRK5pYT",oe=ts({__name:"UserBillings",setup(v){ys();const g=hs.useToast(),f=es();as(()=>{J(),N(),M(),K(),L()});const u=E({card_name:"",card_no:"",country:"",expiry:"",email:"",name:""}),_=E({plan_name:"",expiry_date:"",amount_paid:"",payment_id:"",duration:""}),l=E({active_subs:[],cancelled_subs:[],subscription:[],isSaving:!1,seletedSubPlan:null});async function M(){try{const t=(await y.getPaymentInfo()).data;u.card_name=t.card_name,u.card_no=t.card_no,u.country=t.country,u.expiry=t.expiry,u.email=t.email,u.name=t.name}catch{}}async function K(){try{const t=(await y.getUserSubscription()).data;_.plan_name=t.plans.plan,_.expiry_date=t.expiry_date,_.amount_paid=t.amount_paid,_.payment_id=t.payment_id,_.duration=t.plans.duration+" Days",_.last_paid=t.plans.created_at}catch(a){console.log(a)}}async function L(){try{const t=(await y.getUserSubscriptionPlan()).data;l.active_subs=(t==null?void 0:t.active_subs)??[],l.cancelled_subs=(t==null?void 0:t.cancelled_subs)??[],l.subscription=(t==null?void 0:t.subscription)??[]}catch{}}async function N(){try{const{data:a}=await y.userInvoices(),t=a==null?void 0:a.invoice;B.value=(t==null?void 0:t.total)??0,A.value=(t==null?void 0:t.data)??[],S.value=!1}catch{S.value=!1}}const x=r({page:1,rowsPerPage:15}),B=r(0),A=r([]),S=r(!0),X=[{text:"COMPANY NAME",value:"company_name"},{text:"SUBSCRIPTION STATUS",value:"reg_date"},{text:"BILLING CYCLE",value:"next_billing_cycle"},{text:"LAST PAYMENT DATE",value:"last_payment_date"},{text:"NEXT BILLING DATE",value:"next_billing_cycle"},{text:"AMOUNT DUE",value:"amount_due"},{text:"PAYMENT STATUS",value:"status"},{text:"INVOICE",value:"hosted_invoice_url"}];os(x,a=>{N()},{deep:!0});const U=r(null),k=r(null);function Z(){l.seletedSubPlan=null,U.value.click()}async function q(a){try{l.isSaving=!0;const t=a=="pause"?await y.pauseSubscriptionPlan(l.seletedSubPlan.subscription_id):await y.resumeSubscriptionPlan(l.seletedSubPlan.subscription_id);g.success("Subcription Plan updated",{position:"top-right"}),L(),k.value.click(),l.isSaving=!1}catch{g.error("Sorry something went wrong",{position:"top-right"}),l.isSaving=!1}}const O=r(null),R=r(null);async function $(){await W(),O.value.click()}let w=null;function J(){try{w=Stripe(ae)}catch{console.log("could not load stripe")}}let V="",P="";const C=r(!1),D=r(!1);async function W(){try{D.value=!1;const{data:a}=await y.upateCardInfo();V=a.client_secret,a!=null&&a.client_secret&&(C.value=!0),P=w.elements({clientSecret:V});const t={layout:"tabs"};P.create("payment",t).mount("#payment-element"),document.querySelector("#payment-form"),document.addEventListener("submit",Q)}catch(a){console.log(a),D.value=!0}}async function Q(a){a.preventDefault(),Y(!0);const{error:t}=await w.confirmPayment({elements:P,confirmParams:{return_url:window.location.href}});t.type==="card_error"||t.type==="validation_error"?F(t.message):F("An unexpected error occurred."),Y(!1)}function F(a){const t=document.querySelector("#payment-message");t.classList.remove("hidden"),t.textContent=a,setTimeout(function(){t.classList.add("hidden"),t.textContent=""},4e3)}function Y(a){a?(document.querySelector("#submit").disabled=!0,document.querySelector("#spinner").classList.remove("hidden"),document.querySelector("#button-text").classList.add("hidden")):(document.querySelector("#submit").disabled=!1,document.querySelector("#spinner").classList.add("hidden"),document.querySelector("#button-text").classList.remove("hidden"))}ns(()=>{var a;(a=f==null?void 0:f.query)!=null&&a.payment_intent&&ss(f.query.payment_intent)});async function ss(a){try{const t=await y.makeDefaultPament(a);M(),g.success("Card details updated",{position:"top-right"})}catch{g.error("Sorry, Something went wrong",{position:"top-right"})}}return ls(()=>{k.value.click(),R.value.click()}),(a,t)=>{var H;const G=_s("EasyDataTable");return i(),d(T,null,[s("div",vs,[s("div",gs,[s("div",fs,[s("div",xs,[s("div",Ss,[s("div",ks,[s("div",ws,[s("div",Ps,[s("div",Cs,[Ds,Es,Ts,s("div",Is,n(m(h).dateDisplay(_.expiry_date)),1)])])]),s("div",Ms,[s("div",Ls,[s("div",Ns,[Bs,s("div",As,n(m(h).addCommas(_.amount_paid)),1),Us,s("div",qs,n(m(h).dateDisplay(_.last_paid)),1)])])]),s("div",Os,[s("div",Rs,[s("div",Vs,[Fs,s("div",Ys,[c(" Name: "),s("span",null,n(u.card_name??"***"),1)]),s("div",Gs,[c(" Number: "),s("span",null,"**** **** ****"+n(u.card_no??""),1)]),s("div",Hs,[c(" Expiry: "),s("span",null,n(u.expiry??"***"),1)])]),s("div",{class:"card-footer pt-0 border-0 bg-transparent"},[s("a",{onClick:$,href:"#",class:"small fw-bold"},[zs,c(" Edit Card deatils ")])])])]),s("div",js,[s("div",Ks,[s("div",Xs,[s("div",Zs,"Subscription Plans ("+n(l.subscription.length)+") ",1),s("ul",$s,[s("li",Js,[Ws,s("span",Qs,n(l.active_subs.length),1)]),s("li",st,[tt,s("span",et,n(l.cancelled_subs.length),1)])])]),s("div",{class:"card-footer pt-0 border-0 bg-transparent"},[s("a",{href:"#",onClick:Z,class:"small fw-bold"},[at,c(" Manage Subscription")])])])])])])])]),s("div",ot,[s("div",nt,[lt,s("div",it,[is(G,{loading:S.value,class:"easy-data-table","show-index":"",headers:X,items:A.value,"buttons-pagination":"","server-options":x.value,"onUpdate:serverOptions":t[0]||(t[0]=e=>x.value=e),"server-items-length":B.value},{header:p(e=>[s("span",dt,n(e.text=="#"?"S/N":e.text),1)]),"item-reg_date":p(e=>{var b,z,j;return[((b=e==null?void 0:e.subscription)==null?void 0:b.status)=="active"?(i(),d("span",ct,n((z=e==null?void 0:e.subscription)==null?void 0:z.status),1)):(i(),d("span",rt,n((j=e==null?void 0:e.subscription)==null?void 0:j.status),1))]}),"item-status":p(e=>[e.status=="paid"?(i(),d("span",ut,n(e.status),1)):(i(),d("span",_t,n(e.status),1))]),"item-amount_due":p(e=>[c(n(m(h).addCommas(e.amount_due)),1)]),"item-due_date":p(e=>[c(n(m(h).dateDisplay(e.due_date)),1)]),"item-next_billing_cycle":p(e=>{var b;return[c(n(m(h).dateDisplay((b=e==null?void 0:e.subscription)==null?void 0:b.next_billing_cycle)),1)]}),"item-company_name":p(e=>{var b;return[c(n((b=e==null?void 0:e.subscription)==null?void 0:b.company_name),1)]}),"item-last_payment_date":p(e=>[c(n(m(h).dateDisplay(e.created_at)),1)]),"item-hosted_invoice_url":p(e=>[e.hosted_invoice_url?(i(),d("span",pt,[s("a",{href:e.hosted_invoice_url,target:"_blank",style:{"text-decoration":"none"}},yt,8,bt)])):(i(),d("span",ht,"-"))]),_:1},8,["loading","items","server-options","server-items-length"])])])])])]),s("button",{ref_key:"subscriptionPlanModalOpen",ref:U,type:"button",class:"btn d-none","data-bs-toggle":"modal","data-bs-target":"#subscriptionModal"},null,512),s("div",vt,[s("div",gt,[s("div",ft,[s("div",xt,[St,s("button",{ref_key:"subscriptionPlanModalClose",ref:k,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,512)]),s("div",kt,[s("div",wt,[s("div",Pt,[Ct,ds(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>l.seletedSubPlan=e),class:"form-select"},[(i(!0),d(T,null,rs(l.subscription,e=>(i(),d("option",{class:us({"text-success-emphasis":e.status=="active"}),value:e,key:e.id},n(e.company_name??"-")+" (next billing cycle: "+n(m(h).dateDisplay(e.next_billing_cycle))+") ",11,Dt))),128))],512),[[cs,l.seletedSubPlan]])])])]),s("div",Et,[l.isSaving?(i(),d("button",Tt,[It,c(" Loading ")])):(i(),d(T,{key:1},[l.seletedSubPlan?(i(),d("div",Mt,[((H=l.seletedSubPlan)==null?void 0:H.status)=="active"?(i(),d("button",{key:0,onClick:t[2]||(t[2]=e=>q("pause")),type:"button",class:"btn btn-danger"},"Pause Subscription")):(i(),d("button",{key:1,onClick:t[3]||(t[3]=e=>q("resume")),type:"button",class:"btn btn-success"},"Resume Subscription"))])):I("",!0)],64))])])])]),s("button",{ref_key:"cardDetailsModalOpen",ref:O,type:"button",class:"btn d-none","data-bs-toggle":"modal","data-bs-target":"#cardDetailsModal"},null,512),s("div",Lt,[s("div",Nt,[s("div",Bt,[s("div",At,[Ut,s("button",{ref_key:"cardDetailsModalClose",ref:R,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,512)]),s("div",qt,[D.value?(i(),d("div",Ot,[Rt,c(" loading payment information, please refresh page. "),Vt])):(i(),d("div",Ft,[s("div",Yt,[s("form",Gt,[Ht,C.value?(i(),d("div",zt,Xt)):I("",!0),Zt,s("div",$t,[Jt,C.value?(i(),d("button",Wt,te)):I("",!0)])])])]))]),ee])])])],64)}}}),re=ms(oe,[["__scopeId","data-v-eb41ec39"]]);export{re as default};
