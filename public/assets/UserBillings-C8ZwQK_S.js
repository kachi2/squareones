import{d as J,k as Q,p as P,r,l as ss,O as es,o as i,c as d,b as s,t as n,e as m,f as c,B as ts,s as p,w as as,x as os,G as C,H as ns,y as ls,g as D,A as is,C as ds,D as cs,_ as rs}from"./index-bJf0D_xI.js";import{a as h}from"./index-DNXFy-b_.js";import{u as us}from"./paramsStore-CO7Ns0Of.js";import{u as y}from"./useFunctions-7hk1pswv.js";import{d as _s}from"./index-CeG8Vrn-.js";const o=v=>(ds("data-v-b5b73839"),v=v(),cs(),v),ps={class:"container"},bs={class:"row g-4"},ms={class:"col-lg-12"},ys={class:"card shadow-sm py-3"},hs={class:"card-body"},vs={class:"row g-3"},gs={class:"col-lg-3 col-md-6"},fs={class:"card h-100 border-grey"},xs={class:"card-body"},Ss=o(()=>s("div",{class:"small text-grey fw-bold"},"Pending Renewal",-1)),ks=o(()=>s("div",{class:"fs-4 text-primary fw-bold"},"0",-1)),ws=o(()=>s("div",{class:"small text-grey fw-bold"},"Next renewal date:",-1)),Ps={class:"fw-bold"},Cs={class:"col-lg-3 col-md-6"},Ds={class:"card h-100 border-grey"},Is={class:"card-body"},Ts=o(()=>s("div",{class:"small text-grey fw-bold"},"Total Payments made:",-1)),Es={class:"fs-4 text-primary fw-bold"},Ls=o(()=>s("div",{class:"small text-grey fw-bold"},"last payment date:",-1)),Ms={class:"fw-bold"},Ns={class:"col-lg-3 col-md-6"},As={class:"card h-100",style:{border:"1px blue solid !important"}},Bs={class:"card-body pb-1"},Os=o(()=>s("div",{class:"fw-bold"},"Card details",-1)),Us={class:"text-grey fw-bold text-capitalize"},qs={class:"text-grey fw-bold"},Rs={class:"text-grey fw-bold"},Vs=o(()=>s("i",{class:"bi bi-pencil"},null,-1)),Fs={class:"col-lg-3 col-md-6"},Gs={class:"card h-100",style:{border:"1px blue solid !important"}},Ys={class:"card-body pb-1"},Hs={class:"fw-bold"},js={class:"list-group list-group-flush xsmall"},zs={class:"list-group-item p-0 border-0"},Ks=o(()=>s("strong",{class:"text-muted"},"Active Suscriptions:",-1)),Ws={class:"float-end badge bg-success-subtle text-dark"},Xs={class:"list-group-item p-0 border-0"},Zs=o(()=>s("strong",{class:"text-muted"},"Paused Suscriptions:",-1)),$s={class:"float-end badge bg-danger-subtle text-dark"},Js=o(()=>s("i",{class:"bi bi-gear-wide"},null,-1)),Qs={class:"col-12 mt-4"},se={class:"card"},ee=o(()=>s("div",{class:"fw-bold mb-2 p-3"},"Billing History",-1)),te={class:"card-body"},ae={class:"fw-bold text-muted"},oe={key:0,class:"badge bg-success-subtle text-dark"},ne={key:1,class:"badge bg-secondary-subtle text-dark"},le={key:0,class:"badge bg-success-subtle text-dark"},ie={key:1,class:"badge bg-secondary-subtle text-dark"},de={key:0,class:"text-nowrap"},ce=["href"],re=o(()=>s("i",{class:"bi bi-file-arrow-down-fill"},null,-1)),ue=o(()=>s("strong",null," DOWNLOAD",-1)),_e=[re,ue],pe={key:1},be={class:"modal fade",id:"subscriptionModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false",role:"dialog","aria-labelledby":"modalTitleId","aria-hidden":"true"},me={class:"modal-dialog modal-dialog-scrollable modal-dialog-centered",role:"document"},ye={class:"modal-content"},he={class:"modal-header border-0"},ve=o(()=>s("h5",{class:"modal-title",id:"modalTitleId"}," Subscription Plan ",-1)),ge={class:"modal-body"},fe={class:"row g-3"},xe={class:"col-12"},Se=o(()=>s("div",{for:"",class:"form-label"},"Select Plan",-1)),ke=["value"],we={class:"modal-footer border-0"},Pe={key:0,class:"btn btn-secondary",type:"button",disabled:""},Ce=o(()=>s("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),De={key:0},Ie={class:"modal fade",id:"cardDetailsModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false",role:"dialog","aria-labelledby":"modalTitleId","aria-hidden":"true"},Te={class:"modal-dialog modal-dialog-scrollable modal-dialog-centered",role:"document"},Ee={class:"modal-content"},Le={class:"modal-header"},Me=o(()=>s("h5",{class:"modal-title",id:"modalTitleId"}," Card Details ",-1)),Ne={class:"modal-body"},Ae={key:0,class:"text-center text-danger mt-5"},Be=o(()=>s("strong",null,"Error!",-1)),Oe=o(()=>s("hr",null,null,-1)),Ue={key:1},qe={class:"row justify-content-center"},Re={id:"payment-form"},Ve=o(()=>s("div",{id:"payment-element"},null,-1)),Fe={key:0,class:"form-check"},Ge=o(()=>s("input",{class:"form-check-input exemption",type:"checkbox",value:"",id:"checker"},null,-1)),Ye=o(()=>s("label",{class:"form-check-label",for:"checker"},[s("div",{class:"fw-bold"}," Securely save my information for 1-click checkout "),s("span",null," Pay faster on Stripe Atlas and everywhere Link is accepted ")],-1)),He=[Ge,Ye],je=o(()=>s("div",{id:"payment-message",class:"hidden"},null,-1)),ze={class:"col-12"},Ke=o(()=>s("button",{type:"button",class:"btn btn-secondary me-4","data-bs-dismiss":"modal"}," Close ",-1)),We={key:0,id:"submit",class:"btn btn-primary"},Xe=o(()=>s("div",{class:"spinner hidden",id:"spinner"},null,-1)),Ze=o(()=>s("span",{id:"button-text"},"Pay now",-1)),$e=[Xe,Ze],Je=o(()=>s("div",{class:"modal-footer"},null,-1)),Qe="pk_test_51P7LhqRxBSKsFyqbPdmjZpG4tFsnyLZEV6Tn38aic7H4oeWOSub5gTRnjF4vgdRbBJutMM0G3d2x3c9VFz2g1dkX00bPRK5pYT",st=J({__name:"UserBillings",setup(v){us();const I=_s.useToast();Q(()=>{E(),j(),z(),T()});const u=P({card_name:"",card_no:"",country:"",expiry:"",email:"",name:""}),_=P({plan_name:"",expiry_date:"",amount_paid:"",payment_id:"",duration:""}),l=P({active_subs:[],cancelled_subs:[],subscription:[],isSaving:!1,seletedSubPlan:null});async function j(){try{const a=await h.getPaymentInfo();console.log(a,"payment Information Data");const e=a.data;u.card_name=e.card_name,u.card_no=e.card_no,u.country=e.country,u.expiry=e.expiry,u.email=e.email,u.name=e.name}catch(a){console.log(a)}}async function z(){try{const a=await h.getUserSubscription();console.log(a,"getUserSubscription");const e=a.data;_.plan_name=e.plans.plan,_.expiry_date=e.expiry_date,_.amount_paid=e.amount_paid,_.payment_id=e.payment_id,_.duration=e.plans.duration+" Days",_.last_paid=e.plans.created_at}catch(a){console.log(a)}}async function T(){try{const a=await h.getUserSubscriptionPlan();console.log(a,"getUserSubscriptionPlan");const e=a.data;l.active_subs=(e==null?void 0:e.active_subs)??[],l.cancelled_subs=(e==null?void 0:e.cancelled_subs)??[],l.subscription=(e==null?void 0:e.subscription)??[]}catch{}}async function E(){try{const{data:a}=await h.userInvoices(),e=a==null?void 0:a.invoice;console.log(a,"Get User Invoice"),L.value=(e==null?void 0:e.total)??0,M.value=(e==null?void 0:e.data)??[],f.value=!1}catch{f.value=!1}}const g=r({page:1,rowsPerPage:15}),L=r(0),M=r([]),f=r(!0),K=[{text:"COMPANY NAME",value:"company_name"},{text:"SUBSCRIPTION STATUS",value:"reg_date"},{text:"BILLING CYCLE",value:"next_billing_cycle"},{text:"LAST PAYMENT DATE",value:"last_payment_date"},{text:"NEXT BILLING DATE",value:"due_date"},{text:"AMOUNT DUE",value:"amount_due"},{text:"PAYMENT STATUS",value:"status"},{text:"INVOICE",value:"invoice_pdf"}];ss(g,a=>{E()},{deep:!0});const N=r(null),x=r(null);function W(){l.seletedSubPlan=null,N.value.click()}async function A(a){try{l.isSaving=!0;const e=a=="pause"?await h.pauseSubscriptionPlan(l.seletedSubPlan.subscription_id):await h.resumeSubscriptionPlan(l.seletedSubPlan.subscription_id);console.log(e,"ssssssss"),I.success("Subcription Plan updated",{position:"top-right"}),T(),x.value.click(),l.isSaving=!1}catch{I.error("Sorry something went wrong",{position:"top-right"}),l.isSaving=!1}}const B=r(null),O=r(null);async function X(){await Z(),B.value.click()}const U=Stripe(Qe);let q="",S="";const k=r(!1),w=r(!1);async function Z(){try{w.value=!1;const{data:a}=await h.upateCardInfo();q=a.client_secret,a!=null&&a.client_secret&&(k.value=!0),S=U.elements({clientSecret:q});const e={layout:"tabs"};S.create("payment",e).mount("#payment-element"),document.querySelector("#payment-form"),document.addEventListener("submit",$)}catch(a){console.log(a),w.value=!0}}async function $(a){a.preventDefault(),V(!0);const{error:e}=await U.confirmPayment({elements:S,confirmParams:{return_url:window.location.href}});e.type==="card_error"||e.type==="validation_error"?R(e.message):R("An unexpected error occurred."),V(!1)}function R(a){const e=document.querySelector("#payment-message");e.classList.remove("hidden"),e.textContent=a,setTimeout(function(){e.classList.add("hidden"),e.textContent=""},4e3)}function V(a){a?(document.querySelector("#submit").disabled=!0,document.querySelector("#spinner").classList.remove("hidden"),document.querySelector("#button-text").classList.add("hidden")):(document.querySelector("#submit").disabled=!1,document.querySelector("#spinner").classList.add("hidden"),document.querySelector("#button-text").classList.remove("hidden"))}return es(()=>{x.value.click(),O.value.click()}),(a,e)=>{var G;const F=is("EasyDataTable");return i(),d(C,null,[s("div",ps,[s("div",bs,[s("div",ms,[s("div",ys,[s("div",hs,[s("div",vs,[s("div",gs,[s("div",fs,[s("div",xs,[Ss,ks,ws,s("div",Ps,n(m(y).dateDisplay(_.expiry_date)),1)])])]),s("div",Cs,[s("div",Ds,[s("div",Is,[Ts,s("div",Es,n(m(y).addCommas(_.amount_paid)),1),Ls,s("div",Ms,n(m(y).dateDisplay(_.last_paid)),1)])])]),s("div",Ns,[s("div",As,[s("div",Bs,[Os,s("div",Us,[c(" Name: "),s("span",null,n(u.card_name??"***"),1)]),s("div",qs,[c(" Number: "),s("span",null,"**** **** ****"+n(u.card_no??""),1)]),s("div",Rs,[c(" Expiry: "),s("span",null,n(u.expiry??"***"),1)])]),s("div",{class:"card-footer pt-0 border-0 bg-transparent"},[s("a",{onClick:X,href:"#",class:"small fw-bold"},[Vs,c(" Edit Card deatils ")])])])]),s("div",Fs,[s("div",Gs,[s("div",Ys,[s("div",Hs,"Subscription Plans ("+n(l.subscription.length)+") ",1),s("ul",js,[s("li",zs,[Ks,s("span",Ws,n(l.active_subs.length),1)]),s("li",Xs,[Zs,s("span",$s,n(l.cancelled_subs.length),1)])])]),s("div",{class:"card-footer pt-0 border-0 bg-transparent"},[s("a",{href:"#",onClick:W,class:"small fw-bold"},[Js,c(" Manage Subscription")])])])])])])])]),s("div",Qs,[s("div",se,[ee,s("div",te,[ts(F,{loading:f.value,class:"easy-data-table","show-index":"",headers:K,items:M.value,"buttons-pagination":"","server-options":g.value,"onUpdate:serverOptions":e[0]||(e[0]=t=>g.value=t),"server-items-length":L.value},{header:p(t=>[s("span",ae,n(t.text=="#"?"S/N":t.text),1)]),"item-reg_date":p(t=>{var b,Y,H;return[((b=t==null?void 0:t.subscription)==null?void 0:b.status)=="active"?(i(),d("span",oe,n((Y=t==null?void 0:t.subscription)==null?void 0:Y.status),1)):(i(),d("span",ne,n((H=t==null?void 0:t.subscription)==null?void 0:H.status),1))]}),"item-status":p(t=>[t.status=="paid"?(i(),d("span",le,n(t.status),1)):(i(),d("span",ie,n(t.status),1))]),"item-amount_due":p(t=>[c(n(m(y).addCommas(t.amount_due)),1)]),"item-due_date":p(t=>[c(n(m(y).dateDisplay(t.due_date)),1)]),"item-next_billing_cycle":p(t=>{var b;return[c(n(m(y).dateDisplay((b=t==null?void 0:t.subscription)==null?void 0:b.next_billing_cycle)),1)]}),"item-company_name":p(t=>{var b;return[c(n((b=t==null?void 0:t.subscription)==null?void 0:b.company_name),1)]}),"item-last_payment_date":p(t=>[c(n(m(y).dateDisplay(t.created_at)),1)]),"item-invoice_pdf":p(t=>[t.invoice_pdf?(i(),d("span",de,[s("a",{href:t.invoice_pdf,target:"_blank"},_e,8,ce)])):(i(),d("span",pe,"-"))]),_:1},8,["loading","items","server-options","server-items-length"])])])])])]),s("button",{ref_key:"subscriptionPlanModalOpen",ref:N,type:"button",class:"btn d-none","data-bs-toggle":"modal","data-bs-target":"#subscriptionModal"},null,512),s("div",be,[s("div",me,[s("div",ye,[s("div",he,[ve,s("button",{ref_key:"subscriptionPlanModalClose",ref:x,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,512)]),s("div",ge,[s("div",fe,[s("div",xe,[Se,as(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>l.seletedSubPlan=t),class:"form-select"},[(i(!0),d(C,null,ns(l.subscription,t=>(i(),d("option",{class:ls({"text-success-emphasis":t.status=="active"}),value:t,key:t.id},n(t.company_name??"-")+" (next billing cycle: "+n(m(y).dateDisplay(t.next_billing_cycle))+") ",11,ke))),128))],512),[[os,l.seletedSubPlan]])])])]),s("div",we,[l.isSaving?(i(),d("button",Pe,[Ce,c(" Loading ")])):(i(),d(C,{key:1},[l.seletedSubPlan?(i(),d("div",De,[((G=l.seletedSubPlan)==null?void 0:G.status)=="active"?(i(),d("button",{key:0,onClick:e[2]||(e[2]=t=>A("pause")),type:"button",class:"btn btn-danger"},"Pause Subscription")):(i(),d("button",{key:1,onClick:e[3]||(e[3]=t=>A("resume")),type:"button",class:"btn btn-success"},"Resume Subscription"))])):D("",!0)],64))])])])]),s("button",{ref_key:"cardDetailsModalOpen",ref:B,type:"button",class:"btn d-none","data-bs-toggle":"modal","data-bs-target":"#cardDetailsModal"},null,512),s("div",Ie,[s("div",Te,[s("div",Ee,[s("div",Le,[Me,s("button",{ref_key:"cardDetailsModalClose",ref:O,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,512)]),s("div",Ne,[w.value?(i(),d("div",Ae,[Be,c(" loading payment information, please refresh page. "),Oe])):(i(),d("div",Ue,[s("div",qe,[s("form",Re,[Ve,k.value?(i(),d("div",Fe,He)):D("",!0),je,s("div",ze,[Ke,k.value?(i(),d("button",We,$e)):D("",!0)])])])]))]),Je])])])],64)}}}),lt=rs(st,[["__scopeId","data-v-b5b73839"]]);export{lt as default};
