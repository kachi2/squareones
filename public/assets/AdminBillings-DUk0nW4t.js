import{d as es,q as I,l as os,r as g,n as Y,Q as as,o as c,c as r,b as s,t as i,e as b,f as m,w as k,W as z,s as H,x as v,z as ns,v as F,g as P,y as G,H as J,I as is,B as q,D as ds,E as ls,_ as cs}from"./index-Cx72Huz2.js";import{a as w}from"./index-DONKfzbq.js";import{u as rs}from"./adminParamsStore-Da-Wnp2K.js";import{u as h}from"./useFunctions-BiFwKrCF.js";import{d as _s}from"./index-B5ITiLTV.js";import{j as us}from"./maska-Cp-LWreF.js";import{J as ps}from"./StartCompany_jsonData-D7IJQ8VJ.js";import"./country-Dh2q9MdB.js";import"./_commonjsHelpers-BosuxZz1.js";const d=C=>(ds("data-v-280d40bb"),C=C(),ls(),C),ms={class:"container"},bs=d(()=>s("h5",{class:"fw-bold page-title mb-4"}," Billing",-1)),vs={class:"row g-4"},hs={class:"col-lg-12"},gs={class:"card shadow-sm py-3"},fs={class:"card-body"},ys={class:"row g-3"},xs={class:"col-lg-3 col-md-6"},ks={class:"card h-100 border-grey"},ws={class:"card-body"},Cs={class:"small text-grey fw-bold"},Is={class:"fs-4 text-primary fw-bold"},Ls=d(()=>s("div",{class:"small text-grey fw-bold"},"Total in Last 31 Days",-1)),Ts=d(()=>s("div",{class:"fw-bold"},"$0",-1)),Ns={class:"card-footer border-0 bg-transparent"},Ss={key:0,class:"spinner-border text-primary spinner-border-sm float-end",role:"status"},Ps=d(()=>s("span",{class:"visually-hidden"},"Loading...",-1)),As=[Ps],Ds=d(()=>s("i",{class:"bi bi-arrow-clockwise"},null,-1)),Us={class:"col-lg-3 col-md-6"},Es={class:"card h-100 border-grey"},Bs={class:"card-body"},Ms={class:"small text-grey fw-bold"},$s={class:"fs-4 text-primary fw-bold"},Vs={class:"small text-grey fw-bold"},Rs={class:"fw-bold"},Ys={class:"card-footer border-0 bg-transparent"},zs={key:0,class:"spinner-border text-primary spinner-border-sm float-end",role:"status"},Hs=d(()=>s("span",{class:"visually-hidden"},"Loading...",-1)),Fs=[Hs],Gs=d(()=>s("i",{class:"bi bi-arrow-clockwise"},null,-1)),Js={class:"col-lg-3 col-md-6"},qs={class:"card h-100",style:{border:"1px blue solid !important"}},Qs={class:"card-body"},Ws=d(()=>s("div",{class:"fw-bold"},"Plans Subscription",-1)),Xs={class:"list-group list-group-flush xsmall"},Ks={class:"list-group-item p-0 border-0"},Zs=d(()=>s("strong",{class:"text-muted"},"Name:",-1)),Os={class:"float-end"},js={class:"list-group-item p-0 border-0"},st=d(()=>s("strong",{class:"text-muted"},"Amount:",-1)),tt={class:"float-end"},et={class:"list-group-item p-0 border-0"},ot=d(()=>s("strong",{class:"text-muted"},"Duration:",-1)),at={class:"float-end"},nt={class:"list-group-item p-0 border-0"},it=d(()=>s("strong",{class:"text-muted"},"Currency:",-1)),dt={class:"float-end"},lt={class:"card-footer border-0 bg-transparent"},ct=d(()=>s("i",{class:"bi bi-plus-lg"},null,-1)),rt=d(()=>s("i",{class:"bi bi-pencil"},null,-1)),_t={class:"col-lg-3 col-md-6"},ut={class:"card h-100",style:{border:"1px blue solid !important"}},pt={class:"card-body"},mt=d(()=>s("div",{class:"fw-bold"},"Subscriptions",-1)),bt={class:"list-group list-group-flush xsmall"},vt={class:"list-group-item p-0 border-0"},ht=d(()=>s("strong",{class:"text-muted"},"Active Subcriptions:",-1)),gt={class:"float-end badge bg-success-subtle text-dark"},ft={class:"list-group-item p-0 border-0"},yt=d(()=>s("strong",{class:"text-muted"},"Cancelled subscriptions:",-1)),xt={class:"float-end badge bg-danger-subtle text-dark"},kt={class:"card-footer border-0 bg-transparent"},wt={key:0,class:"spinner-border text-primary spinner-border-sm float-end",role:"status"},Ct=d(()=>s("span",{class:"visually-hidden"},"Loading...",-1)),It=[Ct],Lt=d(()=>s("i",{class:"bi bi-arrow-clockwise"},null,-1)),Tt={class:"col-12 mt-4"},Nt={class:"card shadow-sm min-vh-100"},St={class:"card-body"},Pt=d(()=>s("div",{class:"card-header fw-bold bg-transparent border-0 px-0 py-3"}," Billing Table ",-1)),At={class:"fw-bold text-muted"},Dt={key:0,class:"badge bg-success-subtle text-dark"},Ut={key:1,class:"badge bg-secondary-subtle text-dark"},Et={key:0,class:"badge bg-success-subtle text-dark"},Bt={key:1,class:"badge bg-secondary-subtle text-dark"},Mt={key:0,class:"text-nowrap"},$t=["href"],Vt=d(()=>s("strong",null," View Details",-1)),Rt=[Vt],Yt={key:1},zt={class:"modal fade",id:"planModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false",role:"dialog","aria-labelledby":"modalTitleId","aria-hidden":"true"},Ht={class:"modal-dialog modal-dialog-scrollable modal-dialog-centered",role:"document"},Ft={class:"modal-content"},Gt={class:"modal-header text-capitalize border-0"},Jt={class:"modal-title",id:"modalTitleId"},qt={class:"modal-body"},Qt={class:"row g-3"},Wt=d(()=>s("div",{class:"form-label"},"Name",-1)),Xt={key:0,class:"col-lg-6"},Kt=d(()=>s("div",{class:"form-label"},"Amount",-1)),Zt={key:1,class:"col-lg-6"},Ot=d(()=>s("div",{class:"form-label"},"Duration",-1)),jt=d(()=>s("option",{value:"year",selected:""},"Year",-1)),se=[jt],te={key:2,class:"col-lg-6"},ee=d(()=>s("div",{class:"form-label"},"Currency",-1)),oe=["value"],ae={class:"modal-footer border-0"},ne={key:0,class:"btn btn-primary",type:"button",disabled:""},ie=d(()=>s("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),de=es({__name:"AdminBillings",setup(C){const Q=rs(),f=_s.useToast(),W=I({list:[]});os(()=>{A(),T(),S()});const X=n=>{console.log(n,"compay anme");let e=n.find(u=>u.selected_name==1);e||(e=n.find(u=>u.choice_level==1));let _=e!=null&&e.eng_name?(e==null?void 0:e.eng_name)+" "+(e==null?void 0:e.eng_prefix):"",a=e!=null&&e.chn_name?(e==null?void 0:e.chn_name)+" "+(e==null?void 0:e.chn_prefix):"";return`${_} ${a}`};async function A(){try{const e=(await w.getAllBillings(Q.currentCompanyId)).data.data;Z.value=e.total,O.value=e.data,W.list=e.data,j.value=!1}catch(n){console.log(n)}}const K=g({page:1,rowsPerPage:15}),L=g({page:1,rowsPerPage:15}),Z=g(0),O=g([]),j=g(!0);Y(K,n=>{A()},{deep:!0}),Y(L,n=>{T()},{deep:!0});const l=I({isLoading:!0,total_invoices:0,total_invoice_amount:0,unpaid_invoice:0,unpaid_invoice_amount:0,paid_invoice:0,paid_invoice_amount:0,overdue_invoices:0,overdue_invoices_amount:0,active_subscriptions:0,cancelled_subscriptions:0,invoice_paid_this_monthly:0,invoice_unpaid_monthly_amount:0,invoice_paid_monthly_amount:0,invoice_unpaid_monthly:0,billingsTable:[],totalInvoices:0});async function T(){var n,e;try{const{data:_}=await w.getInvoices(),a=(n=_.data)==null?void 0:n.subscription_summary,u=(e=_==null?void 0:_.data)==null?void 0:e.invoices;l.billingsTable=(u==null?void 0:u.data)??[],l.totalInvoices=(u==null?void 0:u.total)??0,l.total_invoices=a==null?void 0:a.total_invoices,l.total_invoice_amount=a==null?void 0:a.total_invoice_amount,l.unpaid_invoice=a==null?void 0:a.unpaid_invoice,l.unpaid_invoice_amount=a==null?void 0:a.unpaid_invoice_amount,l.paid_invoice=a==null?void 0:a.paid_invoice,l.paid_invoice_amount=a==null?void 0:a.paid_invoice_amount,l.overdue_invoices=a==null?void 0:a.overdue_invoices,l.overdue_invoices_amount=a==null?void 0:a.overdue_invoices_amount,l.active_subscriptions=a==null?void 0:a.active_subscriptions,l.cancelled_subscriptions=a==null?void 0:a.cancelled_subscriptions,l.isLoading=!1}catch(_){console.log(_)}}const y=I({paid:!1,unpaid:!1,subscribers:!1});g([]);async function N(n){y[n]=!0;try{const e=await T();f.success("Invoice Updated",{position:"top-right"}),y[n]=!1}catch{f.error("Error, Something went wrong",{position:"top-right"}),y[n]=!1}}const o=I({data:null,action:"create",isLoading:!1,formName:"",formPrice:"",formInterval:"year",formCurrency:"USD"}),D=g(null),x=g(null);async function S(){try{o.isLoading=!0;const{data:n}=await w.getPlans();o.data=n.data,o.isLoading=!1}catch{}}function U(n){o.action=n,D.value.click()}async function ss(){var e;const n=new FormData;if(o.isLoading=!0,o.action=="create")try{n.append("name",o.formName),n.append("interval",o.formInterval),n.append("currency",o.formCurrency),n.append("price",o.formPrice.replace(/,/g,""));const _=await w.createStripeProduct(n);f.success("Plan Created",{position:"top-right"}),x.value.click(),o.isLoading=!1,S()}catch{f.error("Sorry something went wrong",{position:"top-right"}),x.value.click(),o.isLoading=!1}else try{n.append("name",o.formName),n.append("stripe_product_id",(e=o==null?void 0:o.data)==null?void 0:e.stripe_product_id);const _=await w.updateStripeProduct(n);f.success("Plan Updated",{position:"top-right"}),x.value.click(),o.isLoading=!1,S()}catch{f.error("Sorry something went wrong",{position:"top-right"}),x.value.click(),o.isLoading=!1}}const ts=[{text:"COMPANY NAME",value:"company_name"},{text:"SUBSCRIPTION STATUS",value:"reg_date"},{text:"BILLING CYCLE",value:"next_billing_cycle"},{text:"LAST PAYMENT DATE",value:"last_payment_date"},{text:"NEXT BILLING DATE",value:"next_billing_cycle"},{text:"AMOUNT DUE",value:"amount_due"},{text:"AMOUNT PAID",value:"amount_paid"},{text:"PAYMENT STATUS",value:"status"},{text:"INVOICE",value:"hosted_invoice_url"}];return as(()=>{x.value.click()}),(n,e)=>{var u,E,B,M,$;const _=q("isLoadingComponent"),a=q("EasyDataTable");return c(),r(J,null,[s("div",ms,[bs,s("div",vs,[s("div",hs,[s("div",gs,[s("div",fs,[s("div",ys,[s("div",xs,[s("div",ks,[s("div",ws,[s("div",Cs,"Total paid Invoices ("+i(l.paid_invoice??"0")+") ",1),s("div",Is," $"+i(b(h).addCommas(l.paid_invoice_amount)??"0"),1),Ls,Ts]),s("div",Ns,[y.paid?(c(),r("div",Ss,As)):(c(),r("button",{key:1,onClick:e[0]||(e[0]=t=>N("paid")),class:"btn btn-link text-decoration-none btn-sm p-0 float-end"},[Ds,m(" Refresh ")]))])])]),s("div",Us,[s("div",Es,[s("div",Bs,[s("div",Ms,"Total Unpaid Invoice ("+i(l.unpaid_invoice??"0")+") ",1),s("div",$s," $"+i(b(h).addCommas(l.unpaid_invoice_amount)??"0"),1),s("div",Vs,"Overdue invoice ("+i(l.overdue_invoices??"0")+") ",1),s("div",Rs,"$"+i(b(h).addCommas(l.overdue_invoices_amount)??"0"),1)]),s("div",Ys,[y.unpaid?(c(),r("div",zs,Fs)):(c(),r("button",{key:1,onClick:e[1]||(e[1]=t=>N("unpaid")),class:"btn btn-link text-decoration-none btn-sm p-0 float-end"},[Gs,m(" Refresh")]))])])]),s("div",Js,[s("div",qs,[s("div",Qs,[Ws,s("ul",Xs,[s("li",Ks,[Zs,s("span",Os,i(((u=o.data)==null?void 0:u.plan)??"-"),1)]),s("li",js,[st,s("span",tt,i((E=o.data)!=null&&E.amount?b(h).addCommas(o.data.amount):-0),1)]),s("li",et,[ot,s("span",at,i(((B=o.data)==null?void 0:B.recurring)??"-"),1)]),s("li",nt,[it,s("span",dt,i(((M=o.data)==null?void 0:M.currency)??"-"),1)])])]),s("div",lt,[($=o.data)!=null&&$.stripe_product_id?k((c(),r("button",{key:1,onClick:e[3]||(e[3]=t=>U("update")),class:"btn btn-link text-decoration-none p-0 btn-sm float-end"},[rt,m(" Update plan")],512)),[[z,!o.isLoading]]):k((c(),r("button",{key:0,onClick:e[2]||(e[2]=t=>U("create")),class:"btn btn-link text-decoration-none p-0 btn-sm float-end"},[ct,m(" Create plan")],512)),[[z,!o.isLoading]])])])]),s("div",_t,[s("div",ut,[s("div",pt,[mt,s("ul",bt,[s("li",vt,[ht,s("span",gt,i(l.active_subscriptions),1)]),s("li",ft,[yt,s("span",xt,i(l.cancelled_subscriptions),1)])])]),s("div",kt,[y.subscribers?(c(),r("div",wt,It)):(c(),r("button",{key:1,onClick:e[4]||(e[4]=t=>N("subscribers")),class:"btn btn-link text-decoration-none btn-sm p-0 float-end"},[Lt,m(" Refresh")]))])])])])])])]),s("div",Tt,[s("div",Nt,[s("div",St,[Pt,l.isLoading?(c(),H(_,{key:0})):(c(),H(a,{key:1,class:"easy-data-table","show-index":"",headers:ts,items:l.billingsTable,"buttons-pagination":"","server-options":L.value,"onUpdate:serverOptions":e[5]||(e[5]=t=>L.value=t),"server-items-length":l.totalInvoices},{header:v(t=>[s("span",At,i(t.text=="#"?"S/N":t.text),1)]),"item-reg_date":v(t=>{var p,V,R;return[((p=t==null?void 0:t.subscription)==null?void 0:p.status)=="active"?(c(),r("span",Dt,i((V=t==null?void 0:t.subscription)==null?void 0:V.status),1)):(c(),r("span",Ut,i((R=t==null?void 0:t.subscription)==null?void 0:R.status),1))]}),"item-status":v(t=>[t.status=="paid"?(c(),r("span",Et,i(t.status),1)):(c(),r("span",Bt,i(t.status),1))]),"item-amount_due":v(t=>{var p;return[m(i(b(h).addCommas(t.amount_due))+" "+i((p=t==null?void 0:t.subscription)==null?void 0:p.currency),1)]}),"item-amount_paid":v(t=>{var p;return[m(i(b(h).addCommas(t.amount_paid))+" "+i((p=t==null?void 0:t.subscription)==null?void 0:p.currency),1)]}),"item-next_billing_cycle":v(t=>{var p;return[m(i(b(h).dateDisplay((p=t==null?void 0:t.subscription)==null?void 0:p.next_billing_cycle)),1)]}),"item-company_name":v(t=>[m(i(X(t.company.names)),1)]),"item-due_date":v(t=>[m(i(b(h).dateDisplay(t.due_date)),1)]),"item-last_payment_date":v(t=>[m(i(b(h).dateDisplay(t.created_at)),1)]),"item-hosted_invoice_url":v(t=>[t.hosted_invoice_url?(c(),r("span",Mt,[s("a",{href:t.hosted_invoice_url,target:"_blank",style:{"text-decoration":"none"}},Rt,8,$t)])):(c(),r("span",Yt,"-"))]),_:1},8,["items","server-options","server-items-length"]))])])])])]),s("button",{ref_key:"modalOpen",ref:D,class:"d-none",type:"button","data-bs-toggle":"modal","data-bs-target":"#planModal"},null,512),s("div",zt,[s("div",Ht,[s("div",Ft,[s("div",Gt,[s("h5",Jt,i(o.action)+" Plan ",1),s("button",{ref_key:"modalClose",ref:x,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,512)]),s("div",qt,[s("div",Qt,[s("div",{class:ns(o.action=="create"?"col-lg-6":"col-lg-12")},[Wt,k(s("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.formName=t),class:"form-control",type:"text"},null,512),[[F,o.formName]])],2),o.action=="create"?(c(),r("div",Xt,[Kt,k(s("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.formPrice=t),class:"form-control",type:"text","data-maska":"9,99#","data-maska-tokens":"9:[0-9]:repeated","data-maska-reversed":""},null,512),[[F,o.formPrice],[b(us)]])])):P("",!0),o.action=="create"?(c(),r("div",Zt,[Ot,k(s("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>o.formInterval=t),class:"form-select",name:"",id:""},se,512),[[G,o.formInterval]])])):P("",!0),o.action=="create"?(c(),r("div",te,[ee,k(s("select",{"onUpdate:modelValue":e[9]||(e[9]=t=>o.formCurrency=t),class:"form-select",name:"",id:""},[(c(!0),r(J,null,is(b(ps).currencyCodes,(t,p)=>(c(),r("option",{key:p,value:t},i(t),9,oe))),128))],512),[[G,o.formCurrency]])])):P("",!0)])]),s("div",ae,[o.isLoading?(c(),r("button",ne,[ie,m(" Loading ")])):(c(),r("button",{key:1,onClick:ss,type:"button",class:"btn btn-primary text-capitalize"},i(o.action)+" plan ",1))])])])])],64)}}}),he=cs(de,[["__scopeId","data-v-280d40bb"]]);export{he as default};
