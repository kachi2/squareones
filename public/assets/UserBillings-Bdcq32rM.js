import{d as st,k as et,l as at,q as E,r,n as ot,p as nt,Q as lt,o as i,c as d,b as t,t as n,e as m,f as c,C as it,x as p,w as dt,y as ct,H as I,I as rt,z as ut,g as T,B as _t,D as pt,E as bt,_ as mt}from"./index-Cx72Huz2.js";import{a as y}from"./index-DONKfzbq.js";import{u as yt}from"./paramsStore-CB1laf9o.js";import{u as h}from"./useFunctions-BiFwKrCF.js";import{d as ht}from"./index-B5ITiLTV.js";import"./_commonjsHelpers-BosuxZz1.js";const o=v=>(pt("data-v-eb41ec39"),v=v(),bt(),v),vt={class:"container"},gt={class:"row g-4"},ft={class:"col-lg-12"},xt={class:"card shadow-sm py-3"},St={class:"card-body"},kt={class:"row g-3"},wt={class:"col-lg-3 col-md-6"},Pt={class:"card h-100 border-grey"},Ct={class:"card-body"},Dt=o(()=>t("div",{class:"small text-grey fw-bold"},"Pending Renewal",-1)),Et=o(()=>t("div",{class:"fs-4 text-primary fw-bold"},"0",-1)),It=o(()=>t("div",{class:"small text-grey fw-bold"},"Next renewal date:",-1)),Tt={class:"fw-bold"},Mt={class:"col-lg-3 col-md-6"},Lt={class:"card h-100 border-grey"},Nt={class:"card-body"},Bt=o(()=>t("div",{class:"small text-grey fw-bold"},"Total Payments made:",-1)),qt={class:"fs-4 text-primary fw-bold"},At=o(()=>t("div",{class:"small text-grey fw-bold"},"last payment date:",-1)),Ut={class:"fw-bold"},Ot={class:"col-lg-3 col-md-6"},Rt={class:"card h-100",style:{border:"1px blue solid !important"}},Vt={class:"card-body pb-1"},Ft=o(()=>t("div",{class:"fw-bold"},"Card details",-1)),Yt={class:"text-grey fw-bold text-capitalize"},zt={class:"text-grey fw-bold"},Ht={class:"text-grey fw-bold"},Gt=o(()=>t("i",{class:"bi bi-pencil"},null,-1)),jt={class:"col-lg-3 col-md-6"},Kt={class:"card h-100",style:{border:"1px blue solid !important"}},Xt={class:"card-body pb-1"},Zt={class:"fw-bold"},$t={class:"list-group list-group-flush xsmall"},Jt={class:"list-group-item p-0 border-0"},Qt=o(()=>t("strong",{class:"text-muted"},"Active Suscriptions:",-1)),Wt={class:"float-end badge bg-success-subtle text-dark"},ts={class:"list-group-item p-0 border-0"},ss=o(()=>t("strong",{class:"text-muted"},"Paused Suscriptions:",-1)),es={class:"float-end badge bg-danger-subtle text-dark"},as=o(()=>t("i",{class:"bi bi-gear-wide"},null,-1)),os={class:"col-12 mt-4"},ns={class:"card"},ls=o(()=>t("div",{class:"fw-bold mb-2 p-3"},"Billing History",-1)),is={class:"card-body"},ds={class:"fw-bold text-muted"},cs={key:0,class:"badge bg-success-subtle text-dark"},rs={key:1,class:"badge bg-secondary-subtle text-dark"},us={key:0,class:"badge bg-success-subtle text-dark"},_s={key:1,class:"badge bg-secondary-subtle text-dark"},ps={key:0,class:"text-nowrap"},bs=["href"],ms=o(()=>t("strong",null," View Details",-1)),ys=[ms],hs={key:1},vs={class:"modal fade",id:"subscriptionModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false",role:"dialog","aria-labelledby":"modalTitleId","aria-hidden":"true"},gs={class:"modal-dialog modal-dialog-scrollable modal-dialog-centered",role:"document"},fs={class:"modal-content"},xs={class:"modal-header border-0"},Ss=o(()=>t("h5",{class:"modal-title",id:"modalTitleId"}," Subscription Plan ",-1)),ks={class:"modal-body"},ws={class:"row g-3"},Ps={class:"col-12"},Cs=o(()=>t("div",{for:"",class:"form-label"},"Select Plan",-1)),Ds=["value"],Es={class:"modal-footer border-0"},Is={key:0,class:"btn btn-secondary",type:"button",disabled:""},Ts=o(()=>t("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),Ms={key:0},Ls={class:"modal fade",id:"cardDetailsModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false",role:"dialog","aria-labelledby":"modalTitleId","aria-hidden":"true"},Ns={class:"modal-dialog modal-dialog-scrollable modal-dialog-centered",role:"document"},Bs={class:"modal-content"},qs={class:"modal-header"},As=o(()=>t("h5",{class:"modal-title",id:"modalTitleId"}," Card Details ",-1)),Us={class:"modal-body"},Os={key:0,class:"text-center text-danger mt-5"},Rs=o(()=>t("strong",null,"Error!",-1)),Vs=o(()=>t("hr",null,null,-1)),Fs={key:1},Ys={class:"row justify-content-center"},zs={id:"payment-form"},Hs=o(()=>t("div",{id:"payment-element"},null,-1)),Gs={key:0,class:"form-check"},js=o(()=>t("input",{class:"form-check-input exemption",type:"checkbox",value:"",id:"checker"},null,-1)),Ks=o(()=>t("label",{class:"form-check-label",for:"checker"},[t("div",{class:"fw-bol"}," Securely save my information for 1-click checkout ")],-1)),Xs=[js,Ks],Zs=o(()=>t("div",{id:"payment-message",class:"hidden"},null,-1)),$s={class:"col-12 mt-4"},Js=o(()=>t("button",{type:"button",class:"btn btn-secondary me-2","data-bs-dismiss":"modal"}," Close ",-1)),Qs={key:0,id:"submit",class:"btn btn-primary"},Ws=o(()=>t("div",{class:"spinner hidden",id:"spinner"},null,-1)),te=o(()=>t("span",{id:"button-text"},"Update Card Details",-1)),se=[Ws,te],ee=o(()=>t("div",{class:"modal-footer"},null,-1)),ae="pk_test_51P7LhqRxBSKsFyqbPdmjZpG4tFsnyLZEV6Tn38aic7H4oeWOSub5gTRnjF4vgdRbBJutMM0G3d2x3c9VFz2g1dkX00bPRK5pYT",oe=st({__name:"UserBillings",setup(v){yt();const g=ht.useToast(),f=et();at(()=>{J(),N(),M(),K(),L()});const u=E({card_name:"",card_no:"",country:"",expiry:"",email:"",name:""}),_=E({plan_name:"",expiry_date:"",amount_paid:"",payment_id:"",duration:""}),l=E({active_subs:[],cancelled_subs:[],subscription:[],isSaving:!1,seletedSubPlan:null});async function M(){try{const s=(await y.getPaymentInfo()).data;u.card_name=s.card_name,u.card_no=s.card_no,u.country=s.country,u.expiry=s.expiry,u.email=s.email,u.name=s.name}catch{}}async function K(){try{const s=(await y.getUserSubscription()).data;_.plan_name=s.plans.plan,_.expiry_date=s.expiry_date,_.amount_paid=s.amount_paid,_.payment_id=s.payment_id,_.duration=s.plans.duration+" Days",_.last_paid=s.plans.created_at}catch(a){console.log(a)}}async function L(){try{const s=(await y.getUserSubscriptionPlan()).data;l.active_subs=(s==null?void 0:s.active_subs)??[],l.cancelled_subs=(s==null?void 0:s.cancelled_subs)??[],l.subscription=(s==null?void 0:s.subscription)??[]}catch{}}async function N(){try{const{data:a}=await y.userInvoices(),s=a==null?void 0:a.invoice;B.value=(s==null?void 0:s.total)??0,q.value=(s==null?void 0:s.data)??[],S.value=!1}catch{S.value=!1}}const x=r({page:1,rowsPerPage:15}),B=r(0),q=r([]),S=r(!0),X=[{text:"COMPANY NAME",value:"company_name"},{text:"SUBSCRIPTION STATUS",value:"reg_date"},{text:"BILLING CYCLE",value:"next_billing_cycle"},{text:"LAST PAYMENT DATE",value:"last_payment_date"},{text:"NEXT BILLING DATE",value:"next_billing_cycle"},{text:"AMOUNT DUE",value:"amount_due"},{text:"PAYMENT STATUS",value:"status"},{text:"INVOICE",value:"hosted_invoice_url"}];ot(x,a=>{N()},{deep:!0});const A=r(null),k=r(null);function Z(){l.seletedSubPlan=null,A.value.click()}async function U(a){try{l.isSaving=!0;const s=a=="pause"?await y.pauseSubscriptionPlan(l.seletedSubPlan.subscription_id):await y.resumeSubscriptionPlan(l.seletedSubPlan.subscription_id);g.success("Subcription Plan updated",{position:"top-right"}),L(),k.value.click(),l.isSaving=!1}catch{g.error("Sorry something went wrong",{position:"top-right"}),l.isSaving=!1}}const O=r(null),R=r(null);async function $(){await Q(),O.value.click()}let w=null;function J(){try{w=Stripe(ae)}catch{console.log("could not load stripe")}}let V="",P="";const C=r(!1),D=r(!1);async function Q(){try{D.value=!1;const{data:a}=await y.upateCardInfo();V=a.client_secret,a!=null&&a.client_secret&&(C.value=!0),P=w.elements({clientSecret:V});const s={layout:"tabs"};P.create("payment",s).mount("#payment-element"),document.querySelector("#payment-form"),document.addEventListener("submit",W)}catch(a){console.log(a),D.value=!0}}async function W(a){a.preventDefault(),Y(!0);const{error:s}=await w.confirmPayment({elements:P,confirmParams:{return_url:window.location.href}});s.type==="card_error"||s.type==="validation_error"?F(s.message):F("An unexpected error occurred."),Y(!1)}function F(a){const s=document.querySelector("#payment-message");s.classList.remove("hidden"),s.textContent=a,setTimeout(function(){s.classList.add("hidden"),s.textContent=""},4e3)}function Y(a){a?(document.querySelector("#submit").disabled=!0,document.querySelector("#spinner").classList.remove("hidden"),document.querySelector("#button-text").classList.add("hidden")):(document.querySelector("#submit").disabled=!1,document.querySelector("#spinner").classList.add("hidden"),document.querySelector("#button-text").classList.remove("hidden"))}nt(()=>{var a;(a=f==null?void 0:f.query)!=null&&a.payment_intent&&tt(f.query.payment_intent)});async function tt(a){try{const s=await y.makeDefaultPament(a);M(),g.success("Card details updated",{position:"top-right"})}catch{g.error("Sorry, Something went wrong",{position:"top-right"})}}return lt(()=>{k.value.click(),R.value.click()}),(a,s)=>{var H;const z=_t("EasyDataTable");return i(),d(I,null,[t("div",vt,[t("div",gt,[t("div",ft,[t("div",xt,[t("div",St,[t("div",kt,[t("div",wt,[t("div",Pt,[t("div",Ct,[Dt,Et,It,t("div",Tt,n(m(h).dateDisplay(_.expiry_date)),1)])])]),t("div",Mt,[t("div",Lt,[t("div",Nt,[Bt,t("div",qt,n(m(h).addCommas(_.amount_paid)),1),At,t("div",Ut,n(m(h).dateDisplay(_.last_paid)),1)])])]),t("div",Ot,[t("div",Rt,[t("div",Vt,[Ft,t("div",Yt,[c(" Name: "),t("span",null,n(u.card_name??"***"),1)]),t("div",zt,[c(" Number: "),t("span",null,"**** **** ****"+n(u.card_no??""),1)]),t("div",Ht,[c(" Expiry: "),t("span",null,n(u.expiry??"***"),1)])]),t("div",{class:"card-footer pt-0 border-0 bg-transparent"},[t("a",{onClick:$,href:"#",class:"small fw-bold"},[Gt,c(" Edit Card deatils ")])])])]),t("div",jt,[t("div",Kt,[t("div",Xt,[t("div",Zt,"Subscription Plans ("+n(l.subscription.length)+") ",1),t("ul",$t,[t("li",Jt,[Qt,t("span",Wt,n(l.active_subs.length),1)]),t("li",ts,[ss,t("span",es,n(l.cancelled_subs.length),1)])])]),t("div",{class:"card-footer pt-0 border-0 bg-transparent"},[t("a",{href:"#",onClick:Z,class:"small fw-bold"},[as,c(" Manage Subscription")])])])])])])])]),t("div",os,[t("div",ns,[ls,t("div",is,[it(z,{loading:S.value,class:"easy-data-table","show-index":"",headers:X,items:q.value,"buttons-pagination":"","server-options":x.value,"onUpdate:serverOptions":s[0]||(s[0]=e=>x.value=e),"server-items-length":B.value},{header:p(e=>[t("span",ds,n(e.text=="#"?"S/N":e.text),1)]),"item-reg_date":p(e=>{var b,G,j;return[((b=e==null?void 0:e.subscription)==null?void 0:b.status)=="active"?(i(),d("span",cs,n((G=e==null?void 0:e.subscription)==null?void 0:G.status),1)):(i(),d("span",rs,n((j=e==null?void 0:e.subscription)==null?void 0:j.status),1))]}),"item-status":p(e=>[e.status=="paid"?(i(),d("span",us,n(e.status),1)):(i(),d("span",_s,n(e.status),1))]),"item-amount_due":p(e=>[c(n(m(h).addCommas(e.amount_due)),1)]),"item-due_date":p(e=>[c(n(m(h).dateDisplay(e.due_date)),1)]),"item-next_billing_cycle":p(e=>{var b;return[c(n(m(h).dateDisplay((b=e==null?void 0:e.subscription)==null?void 0:b.next_billing_cycle)),1)]}),"item-company_name":p(e=>{var b;return[c(n((b=e==null?void 0:e.subscription)==null?void 0:b.company_name),1)]}),"item-last_payment_date":p(e=>[c(n(m(h).dateDisplay(e.created_at)),1)]),"item-hosted_invoice_url":p(e=>[e.hosted_invoice_url?(i(),d("span",ps,[t("a",{href:e.hosted_invoice_url,target:"_blank",style:{"text-decoration":"none"}},ys,8,bs)])):(i(),d("span",hs,"-"))]),_:1},8,["loading","items","server-options","server-items-length"])])])])])]),t("button",{ref_key:"subscriptionPlanModalOpen",ref:A,type:"button",class:"btn d-none","data-bs-toggle":"modal","data-bs-target":"#subscriptionModal"},null,512),t("div",vs,[t("div",gs,[t("div",fs,[t("div",xs,[Ss,t("button",{ref_key:"subscriptionPlanModalClose",ref:k,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,512)]),t("div",ks,[t("div",ws,[t("div",Ps,[Cs,dt(t("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>l.seletedSubPlan=e),class:"form-select"},[(i(!0),d(I,null,rt(l.subscription,e=>(i(),d("option",{class:ut({"text-success-emphasis":e.status=="active"}),value:e,key:e.id},n(e.company_name??"-")+" (next billing cycle: "+n(m(h).dateDisplay(e.next_billing_cycle))+") ",11,Ds))),128))],512),[[ct,l.seletedSubPlan]])])])]),t("div",Es,[l.isSaving?(i(),d("button",Is,[Ts,c(" Loading ")])):(i(),d(I,{key:1},[l.seletedSubPlan?(i(),d("div",Ms,[((H=l.seletedSubPlan)==null?void 0:H.status)=="active"?(i(),d("button",{key:0,onClick:s[2]||(s[2]=e=>U("pause")),type:"button",class:"btn btn-danger"},"Pause Subscription")):(i(),d("button",{key:1,onClick:s[3]||(s[3]=e=>U("resume")),type:"button",class:"btn btn-success"},"Resume Subscription"))])):T("",!0)],64))])])])]),t("button",{ref_key:"cardDetailsModalOpen",ref:O,type:"button",class:"btn d-none","data-bs-toggle":"modal","data-bs-target":"#cardDetailsModal"},null,512),t("div",Ls,[t("div",Ns,[t("div",Bs,[t("div",qs,[As,t("button",{ref_key:"cardDetailsModalClose",ref:R,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,512)]),t("div",Us,[D.value?(i(),d("div",Os,[Rs,c(" loading payment information, please refresh page. "),Vs])):(i(),d("div",Fs,[t("div",Ys,[t("form",zs,[Hs,C.value?(i(),d("div",Gs,Xs)):T("",!0),Zs,t("div",$s,[Js,C.value?(i(),d("button",Qs,se)):T("",!0)])])])]))]),ee])])])],64)}}}),ue=mt(oe,[["__scopeId","data-v-eb41ec39"]]);export{ue as default};
