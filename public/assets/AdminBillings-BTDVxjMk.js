import{d as et,p as T,k as ot,r as f,l as G,P as at,o as r,c as _,b as t,t as d,e as b,f as p,w,T as J,q as L,s as m,y as nt,v as q,g as M,x as W,G as X,H as it,A as K,C as dt,D as lt,_ as rt}from"./index-BL3LKqUo.js";import{a as C}from"./index-BBikUg89.js";import{u as ct}from"./adminParamsStore-BV2kdFyN.js";import{u as h}from"./useFunctions-DKE50-Xq.js";import{d as _t}from"./index-BZpHW-yP.js";import{j as ut}from"./maska-Cp-LWreF.js";import{J as pt}from"./StartCompany_jsonData-D7IJQ8VJ.js";const n=I=>(dt("data-v-bab5b6b0"),I=I(),lt(),I),mt={class:"container"},vt=n(()=>t("h5",{class:"fw-bold page-title mb-4"}," Billing",-1)),bt={class:"row g-4"},ht={class:"col-lg-12"},gt={class:"card shadow-sm py-3"},ft={class:"card-body"},yt={class:"row g-3"},xt={class:"col-lg-3 col-md-6"},kt={class:"card h-100 border-grey"},wt={class:"card-body"},Ct={class:"small text-grey fw-bold"},It={class:"fs-4 text-primary fw-bold"},Nt=n(()=>t("div",{class:"small text-grey fw-bold"},"Total in Last 31 Days",-1)),Tt=n(()=>t("div",{class:"fw-bold"},"$0",-1)),Lt={class:"card-footer border-0 bg-transparent"},St={key:0,class:"spinner-border text-primary spinner-border-sm float-end",role:"status"},Pt=n(()=>t("span",{class:"visually-hidden"},"Loading...",-1)),At=[Pt],Dt=n(()=>t("i",{class:"bi bi-arrow-clockwise"},null,-1)),Et={class:"col-lg-3 col-md-6"},Ut={class:"card h-100 border-grey"},Mt={class:"card-body"},Bt={class:"small text-grey fw-bold"},$t={class:"fs-4 text-primary fw-bold"},Vt={class:"small text-grey fw-bold"},Yt={class:"fw-bold"},Ht={class:"card-footer border-0 bg-transparent"},Rt={key:0,class:"spinner-border text-primary spinner-border-sm float-end",role:"status"},zt=n(()=>t("span",{class:"visually-hidden"},"Loading...",-1)),Ft=[zt],Gt=n(()=>t("i",{class:"bi bi-arrow-clockwise"},null,-1)),Jt={class:"col-lg-3 col-md-6"},qt={class:"card h-100",style:{border:"1px blue solid !important"}},Wt={class:"card-body"},Xt=n(()=>t("div",{class:"fw-bold"},"Plans Subscription",-1)),Kt={class:"list-group list-group-flush xsmall"},Qt={class:"list-group-item p-0 border-0"},Zt=n(()=>t("strong",{class:"text-muted"},"Name:",-1)),Ot={class:"float-end"},jt={class:"list-group-item p-0 border-0"},ts=n(()=>t("strong",{class:"text-muted"},"Amount:",-1)),ss={class:"float-end"},es={class:"list-group-item p-0 border-0"},os=n(()=>t("strong",{class:"text-muted"},"Duration:",-1)),as={class:"float-end"},ns={class:"list-group-item p-0 border-0"},is=n(()=>t("strong",{class:"text-muted"},"Currency:",-1)),ds={class:"float-end"},ls={class:"card-footer border-0 bg-transparent"},rs=n(()=>t("i",{class:"bi bi-plus-lg"},null,-1)),cs=n(()=>t("i",{class:"bi bi-pencil"},null,-1)),_s={class:"col-lg-3 col-md-6"},us={class:"card h-100",style:{border:"1px blue solid !important"}},ps={class:"card-body"},ms=n(()=>t("div",{class:"fw-bold"},"Subscriptions",-1)),vs={class:"list-group list-group-flush xsmall"},bs={class:"list-group-item p-0 border-0"},hs=n(()=>t("strong",{class:"text-muted"},"Active Subcriptions:",-1)),gs={class:"float-end badge bg-success-subtle text-dark"},fs={class:"list-group-item p-0 border-0"},ys=n(()=>t("strong",{class:"text-muted"},"Cancelled subscriptions:",-1)),xs={class:"float-end badge bg-danger-subtle text-dark"},ks={class:"card-footer border-0 bg-transparent"},ws={key:0,class:"spinner-border text-primary spinner-border-sm float-end",role:"status"},Cs=n(()=>t("span",{class:"visually-hidden"},"Loading...",-1)),Is=[Cs],Ns=n(()=>t("i",{class:"bi bi-arrow-clockwise"},null,-1)),Ts={class:"col-12 mt-4"},Ls={class:"card shadow-sm min-vh-100"},Ss={class:"card-body"},Ps=n(()=>t("div",{class:"card-header fw-bold bg-transparent border-0 px-0 py-3"}," Billing Table ",-1)),As={class:"fw-bold text-muted"},Ds={key:0,class:"badge bg-success-subtle text-dark"},Es={key:1,class:"badge bg-secondary-subtle text-dark"},Us={key:0,class:"text-nowrap"},Ms=["href"],Bs=n(()=>t("i",{class:"bi bi-file-arrow-down-fill"},null,-1)),$s=n(()=>t("strong",null," DOWNLOAD",-1)),Vs=[Bs,$s],Ys={key:1},Hs={class:"col-12 mt-4"},Rs={class:"card shadow-sm min-vh-100"},zs={class:"card-body"},Fs=n(()=>t("div",{class:"card-header fw-bold bg-transparent border-0 px-0 py-3"}," Payment History ",-1)),Gs={class:"fw-bold text-muted"},Js={class:"dropdown"},qs={class:"cursor-pointer bell dropdown-toggle","data-bs-toggle":"dropdown","aria-expanded":"false"},Ws=n(()=>t("i",{class:"bi bi-three-dots text-primary"},null,-1)),Xs={class:"dropdown-menu dropdown-menu-start"},Ks={class:"list-group list-group-flush"},Qs=n(()=>t("i",{class:"bi bi-trash3"},null,-1)),Zs={class:"modal fade",id:"planModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false",role:"dialog","aria-labelledby":"modalTitleId","aria-hidden":"true"},Os={class:"modal-dialog modal-dialog-scrollable modal-dialog-centered",role:"document"},js={class:"modal-content"},te={class:"modal-header text-capitalize border-0"},se={class:"modal-title",id:"modalTitleId"},ee={class:"modal-body"},oe={class:"row g-3"},ae=n(()=>t("div",{class:"form-label"},"Name",-1)),ne={key:0,class:"col-lg-6"},ie=n(()=>t("div",{class:"form-label"},"Amount",-1)),de={key:1,class:"col-lg-6"},le=n(()=>t("div",{class:"form-label"},"Duration",-1)),re=n(()=>t("option",{value:"year",selected:""},"Year",-1)),ce=[re],_e={key:2,class:"col-lg-6"},ue=n(()=>t("div",{class:"form-label"},"Currency",-1)),pe=["value"],me={class:"modal-footer border-0"},ve={key:0,class:"btn btn-primary",type:"button",disabled:""},be=n(()=>t("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),he=et({__name:"AdminBillings",setup(I){const Q=ct(),y=_t.useToast(),S=T({list:[]});ot(()=>{B(),D(),U()});const Z=i=>{i.id;let o="",u="";return S.list.forEach(v=>{const c=v.company.names.find(N=>N.choice_level==1);o=c!=null&&c.eng_name?(c==null?void 0:c.eng_name)+" "+(c==null?void 0:c.eng_prefix):"",u=c!=null&&c.chn_name?(c==null?void 0:c.chn_name)+" "+(c==null?void 0:c.chn_prefix):""}),`${o} ${u}`},O=i=>{i.id;let o="";return S.list.forEach(a=>{o=a.user.name}),o};async function B(){try{const o=(await C.getAllBillings(Q.currentCompanyId)).data.data;$.value=o.total,V.value=o.data,S.list=o.data,Y.value=!1}catch(i){console.log(i)}}const P=f({page:1,rowsPerPage:15}),A=f({page:1,rowsPerPage:15}),$=f(0),V=f([]),Y=f(!0),j=[{text:"COMPANY NAME",value:"email"},{text:"INVOICE NO",value:"invoice_no"},{text:"DATE ISSUED",value:"date_issued"},{text:"DATE PAID",value:"date_paid"},{text:"AMOUNT",value:"amount_paid"},{text:"PAYMENT METHOD",value:"payment_method"},{text:"STATUS",value:"status"}];G(P,i=>{B()},{deep:!0}),G(A,i=>{D()},{deep:!0});const l=T({isLoading:!0,total_invoices:0,total_invoice_amount:0,unpaid_invoice:0,unpaid_invoice_amount:0,paid_invoice:0,paid_invoice_amount:0,overdue_invoices:0,overdue_invoices_amount:0,active_subscriptions:0,cancelled_subscriptions:0,invoice_paid_this_monthly:0,invoice_unpaid_monthly_amount:0,invoice_paid_monthly_amount:0,invoice_unpaid_monthly:0,billingsTable:[],totalInvoices:0});async function D(){var i,o;try{const{data:u}=await C.getInvoices(),a=(i=u.data)==null?void 0:i.subscription_summary,v=(o=u==null?void 0:u.data)==null?void 0:o.invoices;l.billingsTable=(v==null?void 0:v.data)??[],l.totalInvoices=(v==null?void 0:v.total)??0,l.total_invoices=a==null?void 0:a.total_invoices,l.total_invoice_amount=a==null?void 0:a.total_invoice_amount,l.unpaid_invoice=a==null?void 0:a.unpaid_invoice,l.unpaid_invoice_amount=a==null?void 0:a.unpaid_invoice_amount,l.paid_invoice=a==null?void 0:a.paid_invoice,l.paid_invoice_amount=a==null?void 0:a.paid_invoice_amount,l.overdue_invoices=a==null?void 0:a.overdue_invoices,l.overdue_invoices_amount=a==null?void 0:a.overdue_invoices_amount,l.active_subscriptions=a==null?void 0:a.active_subscriptions,l.cancelled_subscriptions=a==null?void 0:a.cancelled_subscriptions,l.isLoading=!1}catch(u){console.log(u)}}const x=T({paid:!1,unpaid:!1,subscribers:!1});async function E(i){x[i]=!0;try{await D(),y.success("Invoice Updated",{position:"top-right"}),x[i]=!1}catch{y.error("Error, Something went wrong",{position:"top-right"}),x[i]=!1}}const e=T({data:null,action:"create",isLoading:!1,formName:"",formPrice:"",formInterval:"year",formCurrency:"USD"}),H=f(null),k=f(null);async function U(){try{e.isLoading=!0;const{data:i}=await C.getPlans();e.data=i.data,e.isLoading=!1}catch{}}function R(i){e.action=i,H.value.click()}async function tt(){var o;const i=new FormData;if(e.isLoading=!0,e.action=="create")try{i.append("name",e.formName),i.append("interval",e.formInterval),i.append("currency",e.formCurrency),i.append("price",e.formPrice.replace(/,/g,""));const u=await C.createStripeProduct(i);y.success("Plan Created",{position:"top-right"}),k.value.click(),e.isLoading=!1,console.log(u),U()}catch{y.error("Sorry something went wrong",{position:"top-right"}),k.value.click(),e.isLoading=!1}else try{i.append("name",e.formName),i.append("stripe_product_id",(o=e==null?void 0:e.data)==null?void 0:o.stripe_product_id);const u=await C.updateStripeProduct(i);y.success("Plan Updated",{position:"top-right"}),k.value.click(),e.isLoading=!1,console.log(u),U()}catch{y.error("Sorry something went wrong",{position:"top-right"}),k.value.click(),e.isLoading=!1}}const st=[{text:"COMPANY NAME",value:"company_name"},{text:"SUBSCRIPTION STATUS",value:"reg_date"},{text:"BILLING CYCLE",value:"next_billing_cycle"},{text:"LAST PAYMENT DATE",value:"last_payment_date"},{text:"NEXT BILLING DATE",value:"due_date"},{text:"AMOUNT DUE",value:"amount_due"},{text:"PAYMENT STATUS",value:"status"},{text:"INVOICE",value:"invoice_pdf"}];return at(()=>{k.value.click()}),(i,o)=>{var v,c,N,z,F;const u=K("isLoadingComponent"),a=K("EasyDataTable");return r(),_(X,null,[t("div",mt,[vt,t("div",bt,[t("div",ht,[t("div",gt,[t("div",ft,[t("div",yt,[t("div",xt,[t("div",kt,[t("div",wt,[t("div",Ct,"Total paid Invoices ("+d(l.paid_invoice??"0")+") ",1),t("div",It," $"+d(b(h).addCommas(l.paid_invoice_amount)??"0"),1),Nt,Tt]),t("div",Lt,[x.paid?(r(),_("div",St,At)):(r(),_("button",{key:1,onClick:o[0]||(o[0]=s=>E("paid")),class:"btn btn-link text-decoration-none btn-sm p-0 float-end"},[Dt,p(" Refresh ")]))])])]),t("div",Et,[t("div",Ut,[t("div",Mt,[t("div",Bt,"Total Unpaid Invoice ("+d(l.unpaid_invoice??"0")+") ",1),t("div",$t," $"+d(b(h).addCommas(l.unpaid_invoice_amount)??"0"),1),t("div",Vt,"Overdue invoice ("+d(l.overdue_invoices??"0")+") ",1),t("div",Yt,"$"+d(b(h).addCommas(l.overdue_invoices_amount)??"0"),1)]),t("div",Ht,[x.unpaid?(r(),_("div",Rt,Ft)):(r(),_("button",{key:1,onClick:o[1]||(o[1]=s=>E("unpaid")),class:"btn btn-link text-decoration-none btn-sm p-0 float-end"},[Gt,p(" Refresh")]))])])]),t("div",Jt,[t("div",qt,[t("div",Wt,[Xt,t("ul",Kt,[t("li",Qt,[Zt,t("span",Ot,d(((v=e.data)==null?void 0:v.plan)??"-"),1)]),t("li",jt,[ts,t("span",ss,d((c=e.data)!=null&&c.amount?b(h).addCommas(e.data.amount):-0),1)]),t("li",es,[os,t("span",as,d(((N=e.data)==null?void 0:N.recurring)??"-"),1)]),t("li",ns,[is,t("span",ds,d(((z=e.data)==null?void 0:z.currency)??"-"),1)])])]),t("div",ls,[(F=e.data)!=null&&F.stripe_product_id?w((r(),_("button",{key:1,onClick:o[3]||(o[3]=s=>R("update")),class:"btn btn-link text-decoration-none p-0 btn-sm float-end"},[cs,p(" Update plan")],512)),[[J,!e.isLoading]]):w((r(),_("button",{key:0,onClick:o[2]||(o[2]=s=>R("create")),class:"btn btn-link text-decoration-none p-0 btn-sm float-end"},[rs,p(" Create plan")],512)),[[J,!e.isLoading]])])])]),t("div",_s,[t("div",us,[t("div",ps,[ms,t("ul",vs,[t("li",bs,[hs,t("span",gs,d(l.active_subscriptions),1)]),t("li",fs,[ys,t("span",xs,d(l.cancelled_subscriptions),1)])])]),t("div",ks,[x.subscribers?(r(),_("div",ws,Is)):(r(),_("button",{key:1,onClick:o[4]||(o[4]=s=>E("subscribers")),class:"btn btn-link text-decoration-none btn-sm p-0 float-end"},[Ns,p(" Refresh")]))])])])])])])]),t("div",Ts,[t("div",Ls,[t("div",Ss,[Ps,l.isLoading?(r(),L(u,{key:0})):(r(),L(a,{key:1,class:"easy-data-table","show-index":"",headers:st,items:l.billingsTable,"buttons-pagination":"","server-options":A.value,"onUpdate:serverOptions":o[5]||(o[5]=s=>A.value=s),"server-items-length":l.totalInvoices},{header:m(s=>[t("span",As,d(s.text=="#"?"S/N":s.text),1)]),"item-status":m(s=>[s.status=="paid"?(r(),_("span",Ds,d(s.status),1)):(r(),_("span",Es,d(s.status),1))]),"item-amount_due":m(s=>[p(d(b(h).addCommas(s.amount_due)),1)]),"item-next_billing_cycle":m(s=>{var g;return[p(d(b(h).dateDisplay((g=s==null?void 0:s.subscription)==null?void 0:g.next_billing_cycle)),1)]}),"item-company_name":m(s=>{var g;return[p(d((g=s==null?void 0:s.subscription)==null?void 0:g.company_name),1)]}),"item-due_date":m(s=>[p(d(b(h).dateDisplay(s.due_date)),1)]),"item-last_payment_date":m(s=>[p(d(b(h).dateDisplay(s.created_at)),1)]),"item-invoice_pdf":m(s=>[s.invoice_pdf?(r(),_("span",Us,[t("a",{href:s.invoice_pdf,target:"_blank"},Vs,8,Ms)])):(r(),_("span",Ys,"-"))]),_:1},8,["items","server-options","server-items-length"]))])])]),t("div",Hs,[t("div",Rs,[t("div",zs,[Fs,Y.value?(r(),L(u,{key:0})):(r(),L(a,{key:1,class:"easy-data-table","show-index":"",headers:j,items:V.value,"buttons-pagination":"","server-options":P.value,"onUpdate:serverOptions":o[7]||(o[7]=s=>P.value=s),"server-items-length":$.value},{header:m(s=>[t("span",Gs,d(s.text=="#"?"S/N":s.text),1)]),"item-name":m(s=>[p(d(O(s)),1)]),"item-names":m(s=>[p(d(Z(s)),1)]),"item-action":m(s=>[t("span",Js,[t("span",qs,[Ws,t("div",Xs,[t("ul",Ks,[t("li",{onClick:o[6]||(o[6]=()=>{}),class:"dropdown-item text-danger",style:{"background-color":"transparent !important"}},[Qs,p(" Delete ")])])])])])]),_:1},8,["items","server-options","server-items-length"]))])])])])]),t("button",{ref_key:"modalOpen",ref:H,class:"d-none",type:"button","data-bs-toggle":"modal","data-bs-target":"#planModal"},null,512),t("div",Zs,[t("div",Os,[t("div",js,[t("div",te,[t("h5",se,d(e.action)+" Plan ",1),t("button",{ref_key:"modalClose",ref:k,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,512)]),t("div",ee,[t("div",oe,[t("div",{class:nt(e.action=="create"?"col-lg-6":"col-lg-12")},[ae,w(t("input",{"onUpdate:modelValue":o[8]||(o[8]=s=>e.formName=s),class:"form-control",type:"text"},null,512),[[q,e.formName]])],2),e.action=="create"?(r(),_("div",ne,[ie,w(t("input",{"onUpdate:modelValue":o[9]||(o[9]=s=>e.formPrice=s),class:"form-control",type:"text","data-maska":"9,99#","data-maska-tokens":"9:[0-9]:repeated","data-maska-reversed":""},null,512),[[q,e.formPrice],[b(ut)]])])):M("",!0),e.action=="create"?(r(),_("div",de,[le,w(t("select",{"onUpdate:modelValue":o[10]||(o[10]=s=>e.formInterval=s),class:"form-select",name:"",id:""},ce,512),[[W,e.formInterval]])])):M("",!0),e.action=="create"?(r(),_("div",_e,[ue,w(t("select",{"onUpdate:modelValue":o[11]||(o[11]=s=>e.formCurrency=s),class:"form-select",name:"",id:""},[(r(!0),_(X,null,it(b(pt).currencyCodes,(s,g)=>(r(),_("option",{key:g,value:s},d(s),9,pe))),128))],512),[[W,e.formCurrency]])])):M("",!0)])]),t("div",me,[e.isLoading?(r(),_("button",ve,[be,p(" Loading ")])):(r(),_("button",{key:1,onClick:tt,type:"button",class:"btn btn-primary text-capitalize"},d(e.action)+" plan ",1))])])])])],64)}}}),Ie=rt(he,[["__scopeId","data-v-bab5b6b0"]]);export{Ie as default};
