import{d as j,p as I,k as tt,r as g,l as $,P as st,o as c,c as r,b as t,t as l,e as u,f as p,w as k,T as R,q as Y,s as v,y as ot,v as H,g as N,x as z,G as F,H as et,A as G,C as at,D as nt,_ as it}from"./index-Dz7npP1i.js";import{a as w}from"./index-DX_5wuwS.js";import{u as dt}from"./adminParamsStore-CkIyjviR.js";import{u as b}from"./useFunctions-D5grCMhf.js";import{d as lt}from"./index-C6G3vVZv.js";import{j as ct}from"./maska-Cp-LWreF.js";import{J as rt}from"./StartCompany_jsonData-D7IJQ8VJ.js";import"./country-Dh2q9MdB.js";const n=C=>(at("data-v-92874f8d"),C=C(),nt(),C),_t={class:"container"},pt=n(()=>t("h5",{class:"fw-bold page-title mb-4"}," Billing",-1)),ut={class:"row g-4"},mt={class:"col-lg-12"},vt={class:"card shadow-sm py-3"},bt={class:"card-body"},ht={class:"row g-3"},gt={class:"col-lg-3 col-md-6"},ft={class:"card h-100 border-grey"},yt={class:"card-body"},xt={class:"small text-grey fw-bold"},kt={class:"fs-4 text-primary fw-bold"},wt=n(()=>t("div",{class:"small text-grey fw-bold"},"Total in Last 31 Days",-1)),Ct=n(()=>t("div",{class:"fw-bold"},"$0",-1)),It={class:"card-footer border-0 bg-transparent"},Lt={key:0,class:"spinner-border text-primary spinner-border-sm float-end",role:"status"},Tt=n(()=>t("span",{class:"visually-hidden"},"Loading...",-1)),St=[Tt],Pt=n(()=>t("i",{class:"bi bi-arrow-clockwise"},null,-1)),Nt={class:"col-lg-3 col-md-6"},At={class:"card h-100 border-grey"},Dt={class:"card-body"},Ut={class:"small text-grey fw-bold"},Et={class:"fs-4 text-primary fw-bold"},Bt={class:"small text-grey fw-bold"},Mt={class:"fw-bold"},Vt={class:"card-footer border-0 bg-transparent"},$t={key:0,class:"spinner-border text-primary spinner-border-sm float-end",role:"status"},Rt=n(()=>t("span",{class:"visually-hidden"},"Loading...",-1)),Yt=[Rt],Ht=n(()=>t("i",{class:"bi bi-arrow-clockwise"},null,-1)),zt={class:"col-lg-3 col-md-6"},Ft={class:"card h-100",style:{border:"1px blue solid !important"}},Gt={class:"card-body"},Jt=n(()=>t("div",{class:"fw-bold"},"Plans Subscription",-1)),qt={class:"list-group list-group-flush xsmall"},Xt={class:"list-group-item p-0 border-0"},Kt=n(()=>t("strong",{class:"text-muted"},"Name:",-1)),Qt={class:"float-end"},Wt={class:"list-group-item p-0 border-0"},Zt=n(()=>t("strong",{class:"text-muted"},"Amount:",-1)),Ot={class:"float-end"},jt={class:"list-group-item p-0 border-0"},ts=n(()=>t("strong",{class:"text-muted"},"Duration:",-1)),ss={class:"float-end"},os={class:"list-group-item p-0 border-0"},es=n(()=>t("strong",{class:"text-muted"},"Currency:",-1)),as={class:"float-end"},ns={class:"card-footer border-0 bg-transparent"},is=n(()=>t("i",{class:"bi bi-plus-lg"},null,-1)),ds=n(()=>t("i",{class:"bi bi-pencil"},null,-1)),ls={class:"col-lg-3 col-md-6"},cs={class:"card h-100",style:{border:"1px blue solid !important"}},rs={class:"card-body"},_s=n(()=>t("div",{class:"fw-bold"},"Subscriptions",-1)),ps={class:"list-group list-group-flush xsmall"},us={class:"list-group-item p-0 border-0"},ms=n(()=>t("strong",{class:"text-muted"},"Active Subcriptions:",-1)),vs={class:"float-end badge bg-success-subtle text-dark"},bs={class:"list-group-item p-0 border-0"},hs=n(()=>t("strong",{class:"text-muted"},"Cancelled subscriptions:",-1)),gs={class:"float-end badge bg-danger-subtle text-dark"},fs={class:"card-footer border-0 bg-transparent"},ys={key:0,class:"spinner-border text-primary spinner-border-sm float-end",role:"status"},xs=n(()=>t("span",{class:"visually-hidden"},"Loading...",-1)),ks=[xs],ws=n(()=>t("i",{class:"bi bi-arrow-clockwise"},null,-1)),Cs={class:"col-12 mt-4"},Is={class:"card shadow-sm min-vh-100"},Ls={class:"card-body"},Ts=n(()=>t("div",{class:"card-header fw-bold bg-transparent border-0 px-0 py-3"}," Billing Table ",-1)),Ss={class:"fw-bold text-muted"},Ps={key:0,class:"badge bg-success-subtle text-dark"},Ns={key:1,class:"badge bg-secondary-subtle text-dark"},As={key:0,class:"text-nowrap"},Ds=["href"],Us=n(()=>t("strong",null," View Details",-1)),Es=[Us],Bs={key:1},Ms={class:"modal fade",id:"planModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false",role:"dialog","aria-labelledby":"modalTitleId","aria-hidden":"true"},Vs={class:"modal-dialog modal-dialog-scrollable modal-dialog-centered",role:"document"},$s={class:"modal-content"},Rs={class:"modal-header text-capitalize border-0"},Ys={class:"modal-title",id:"modalTitleId"},Hs={class:"modal-body"},zs={class:"row g-3"},Fs=n(()=>t("div",{class:"form-label"},"Name",-1)),Gs={key:0,class:"col-lg-6"},Js=n(()=>t("div",{class:"form-label"},"Amount",-1)),qs={key:1,class:"col-lg-6"},Xs=n(()=>t("div",{class:"form-label"},"Duration",-1)),Ks=n(()=>t("option",{value:"year",selected:""},"Year",-1)),Qs=[Ks],Ws={key:2,class:"col-lg-6"},Zs=n(()=>t("div",{class:"form-label"},"Currency",-1)),Os=["value"],js={class:"modal-footer border-0"},to={key:0,class:"btn btn-primary",type:"button",disabled:""},so=n(()=>t("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),oo=j({__name:"AdminBillings",setup(C){const J=dt(),f=lt.useToast(),q=I({list:[]});tt(()=>{A(),T(),P()});async function A(){try{const a=(await w.getAllBillings(J.currentCompanyId)).data.data;K.value=a.total,Q.value=a.data,q.list=a.data,W.value=!1}catch(i){console.log(i)}}const X=g({page:1,rowsPerPage:15}),L=g({page:1,rowsPerPage:15}),K=g(0),Q=g([]),W=g(!0);$(X,i=>{A()},{deep:!0}),$(L,i=>{T()},{deep:!0});const d=I({isLoading:!0,total_invoices:0,total_invoice_amount:0,unpaid_invoice:0,unpaid_invoice_amount:0,paid_invoice:0,paid_invoice_amount:0,overdue_invoices:0,overdue_invoices_amount:0,active_subscriptions:0,cancelled_subscriptions:0,invoice_paid_this_monthly:0,invoice_unpaid_monthly_amount:0,invoice_paid_monthly_amount:0,invoice_unpaid_monthly:0,billingsTable:[],totalInvoices:0});async function T(){var i,a;try{const{data:_}=await w.getInvoices(),e=(i=_.data)==null?void 0:i.subscription_summary,m=(a=_==null?void 0:_.data)==null?void 0:a.invoices;d.billingsTable=(m==null?void 0:m.data)??[],d.totalInvoices=(m==null?void 0:m.total)??0,d.total_invoices=e==null?void 0:e.total_invoices,d.total_invoice_amount=e==null?void 0:e.total_invoice_amount,d.unpaid_invoice=e==null?void 0:e.unpaid_invoice,d.unpaid_invoice_amount=e==null?void 0:e.unpaid_invoice_amount,d.paid_invoice=e==null?void 0:e.paid_invoice,d.paid_invoice_amount=e==null?void 0:e.paid_invoice_amount,d.overdue_invoices=e==null?void 0:e.overdue_invoices,d.overdue_invoices_amount=e==null?void 0:e.overdue_invoices_amount,d.active_subscriptions=e==null?void 0:e.active_subscriptions,d.cancelled_subscriptions=e==null?void 0:e.cancelled_subscriptions,d.isLoading=!1}catch(_){console.log(_)}}const y=I({paid:!1,unpaid:!1,subscribers:!1});async function S(i){y[i]=!0;try{await T(),f.success("Invoice Updated",{position:"top-right"}),y[i]=!1}catch{f.error("Error, Something went wrong",{position:"top-right"}),y[i]=!1}}const s=I({data:null,action:"create",isLoading:!1,formName:"",formPrice:"",formInterval:"year",formCurrency:"USD"}),D=g(null),x=g(null);async function P(){try{s.isLoading=!0;const{data:i}=await w.getPlans();s.data=i.data,s.isLoading=!1}catch{}}function U(i){s.action=i,D.value.click()}async function Z(){var a;const i=new FormData;if(s.isLoading=!0,s.action=="create")try{i.append("name",s.formName),i.append("interval",s.formInterval),i.append("currency",s.formCurrency),i.append("price",s.formPrice.replace(/,/g,""));const _=await w.createStripeProduct(i);f.success("Plan Created",{position:"top-right"}),x.value.click(),s.isLoading=!1,console.log(_),P()}catch{f.error("Sorry something went wrong",{position:"top-right"}),x.value.click(),s.isLoading=!1}else try{i.append("name",s.formName),i.append("stripe_product_id",(a=s==null?void 0:s.data)==null?void 0:a.stripe_product_id);const _=await w.updateStripeProduct(i);f.success("Plan Updated",{position:"top-right"}),x.value.click(),s.isLoading=!1,console.log(_),P()}catch{f.error("Sorry something went wrong",{position:"top-right"}),x.value.click(),s.isLoading=!1}}const O=[{text:"COMPANY NAME",value:"company_name"},{text:"SUBSCRIPTION STATUS",value:"reg_date"},{text:"BILLING CYCLE",value:"next_billing_cycle"},{text:"LAST PAYMENT DATE",value:"last_payment_date"},{text:"NEXT BILLING DATE",value:"due_date"},{text:"AMOUNT DUE",value:"amount_due"},{text:"PAYMENT STATUS",value:"status"},{text:"INVOICE",value:"hosted_invoice_url"}];return st(()=>{x.value.click()}),(i,a)=>{var m,E,B,M,V;const _=G("isLoadingComponent"),e=G("EasyDataTable");return c(),r(F,null,[t("div",_t,[pt,t("div",ut,[t("div",mt,[t("div",vt,[t("div",bt,[t("div",ht,[t("div",gt,[t("div",ft,[t("div",yt,[t("div",xt,"Total paid Invoices ("+l(d.paid_invoice??"0")+") ",1),t("div",kt," $"+l(u(b).addCommas(d.paid_invoice_amount)??"0"),1),wt,Ct]),t("div",It,[y.paid?(c(),r("div",Lt,St)):(c(),r("button",{key:1,onClick:a[0]||(a[0]=o=>S("paid")),class:"btn btn-link text-decoration-none btn-sm p-0 float-end"},[Pt,p(" Refresh ")]))])])]),t("div",Nt,[t("div",At,[t("div",Dt,[t("div",Ut,"Total Unpaid Invoice ("+l(d.unpaid_invoice??"0")+") ",1),t("div",Et," $"+l(u(b).addCommas(d.unpaid_invoice_amount)??"0"),1),t("div",Bt,"Overdue invoice ("+l(d.overdue_invoices??"0")+") ",1),t("div",Mt,"$"+l(u(b).addCommas(d.overdue_invoices_amount)??"0"),1)]),t("div",Vt,[y.unpaid?(c(),r("div",$t,Yt)):(c(),r("button",{key:1,onClick:a[1]||(a[1]=o=>S("unpaid")),class:"btn btn-link text-decoration-none btn-sm p-0 float-end"},[Ht,p(" Refresh")]))])])]),t("div",zt,[t("div",Ft,[t("div",Gt,[Jt,t("ul",qt,[t("li",Xt,[Kt,t("span",Qt,l(((m=s.data)==null?void 0:m.plan)??"-"),1)]),t("li",Wt,[Zt,t("span",Ot,l((E=s.data)!=null&&E.amount?u(b).addCommas(s.data.amount):-0),1)]),t("li",jt,[ts,t("span",ss,l(((B=s.data)==null?void 0:B.recurring)??"-"),1)]),t("li",os,[es,t("span",as,l(((M=s.data)==null?void 0:M.currency)??"-"),1)])])]),t("div",ns,[(V=s.data)!=null&&V.stripe_product_id?k((c(),r("button",{key:1,onClick:a[3]||(a[3]=o=>U("update")),class:"btn btn-link text-decoration-none p-0 btn-sm float-end"},[ds,p(" Update plan")],512)),[[R,!s.isLoading]]):k((c(),r("button",{key:0,onClick:a[2]||(a[2]=o=>U("create")),class:"btn btn-link text-decoration-none p-0 btn-sm float-end"},[is,p(" Create plan")],512)),[[R,!s.isLoading]])])])]),t("div",ls,[t("div",cs,[t("div",rs,[_s,t("ul",ps,[t("li",us,[ms,t("span",vs,l(d.active_subscriptions),1)]),t("li",bs,[hs,t("span",gs,l(d.cancelled_subscriptions),1)])])]),t("div",fs,[y.subscribers?(c(),r("div",ys,ks)):(c(),r("button",{key:1,onClick:a[4]||(a[4]=o=>S("subscribers")),class:"btn btn-link text-decoration-none btn-sm p-0 float-end"},[ws,p(" Refresh")]))])])])])])])]),t("div",Cs,[t("div",Is,[t("div",Ls,[Ts,d.isLoading?(c(),Y(_,{key:0})):(c(),Y(e,{key:1,class:"easy-data-table","show-index":"",headers:O,items:d.billingsTable,"buttons-pagination":"","server-options":L.value,"onUpdate:serverOptions":a[5]||(a[5]=o=>L.value=o),"server-items-length":d.totalInvoices},{header:v(o=>[t("span",Ss,l(o.text=="#"?"S/N":o.text),1)]),"item-status":v(o=>[o.status=="paid"?(c(),r("span",Ps,l(o.status),1)):(c(),r("span",Ns,l(o.status),1))]),"item-amount_due":v(o=>[p(l(u(b).addCommas(o.amount_due)),1)]),"item-next_billing_cycle":v(o=>{var h;return[p(l(u(b).dateDisplay((h=o==null?void 0:o.subscription)==null?void 0:h.next_billing_cycle)),1)]}),"item-company_name":v(o=>{var h;return[p(l((h=o==null?void 0:o.subscription)==null?void 0:h.company_name),1)]}),"item-due_date":v(o=>[p(l(u(b).dateDisplay(o.due_date)),1)]),"item-last_payment_date":v(o=>[p(l(u(b).dateDisplay(o.created_at)),1)]),"item-hosted_invoice_url":v(o=>[o.hosted_invoice_url?(c(),r("span",As,[t("a",{href:o.hosted_invoice_url,target:"_blank",style:{"text-decoration":"none"}},Es,8,Ds)])):(c(),r("span",Bs,"-"))]),_:1},8,["items","server-options","server-items-length"]))])])])])]),t("button",{ref_key:"modalOpen",ref:D,class:"d-none",type:"button","data-bs-toggle":"modal","data-bs-target":"#planModal"},null,512),t("div",Ms,[t("div",Vs,[t("div",$s,[t("div",Rs,[t("h5",Ys,l(s.action)+" Plan ",1),t("button",{ref_key:"modalClose",ref:x,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,512)]),t("div",Hs,[t("div",zs,[t("div",{class:ot(s.action=="create"?"col-lg-6":"col-lg-12")},[Fs,k(t("input",{"onUpdate:modelValue":a[6]||(a[6]=o=>s.formName=o),class:"form-control",type:"text"},null,512),[[H,s.formName]])],2),s.action=="create"?(c(),r("div",Gs,[Js,k(t("input",{"onUpdate:modelValue":a[7]||(a[7]=o=>s.formPrice=o),class:"form-control",type:"text","data-maska":"9,99#","data-maska-tokens":"9:[0-9]:repeated","data-maska-reversed":""},null,512),[[H,s.formPrice],[u(ct)]])])):N("",!0),s.action=="create"?(c(),r("div",qs,[Xs,k(t("select",{"onUpdate:modelValue":a[8]||(a[8]=o=>s.formInterval=o),class:"form-select",name:"",id:""},Qs,512),[[z,s.formInterval]])])):N("",!0),s.action=="create"?(c(),r("div",Ws,[Zs,k(t("select",{"onUpdate:modelValue":a[9]||(a[9]=o=>s.formCurrency=o),class:"form-select",name:"",id:""},[(c(!0),r(F,null,et(u(rt).currencyCodes,(o,h)=>(c(),r("option",{key:h,value:o},l(o),9,Os))),128))],512),[[z,s.formCurrency]])])):N("",!0)])]),t("div",js,[s.isLoading?(c(),r("button",to,[so,p(" Loading ")])):(c(),r("button",{key:1,onClick:Z,type:"button",class:"btn btn-primary text-capitalize"},l(s.action)+" plan ",1))])])])])],64)}}}),po=it(oo,[["__scopeId","data-v-92874f8d"]]);export{po as default};
